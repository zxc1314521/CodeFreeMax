import{bt as q,x as H,bu as K,d as R,e as G,c as o,a as e,t as d,F as D,f as I,M as N,bv as J,b as U,w as b,bw as k,bx as B,r,g as m,h as w,o as n,R as C,_ as Q}from"./index-0b7F522w.js";import{e as W,C as X}from"./channels-CdsIN6g2.js";import{u as Y}from"./use-message-III38vxu.js";function Z(){const x=H(K,null);return x===null&&q("use-dialog","No outer <n-dialog-provider /> founded."),x}const ee={class:"models-page"},te={class:"page-header"},le={class:"header-actions"},se=["disabled"],ae={class:"channel-tabs"},oe=["onClick"],ne={class:"ch-count"},de={class:"card"},ie={key:0,class:"empty-state"},ue={key:1,class:"empty-state"},re={key:2,class:"data-table"},ce={class:"text-muted"},ve={class:"model-id"},be={key:0,class:"badge badge-primary"},pe={key:1,class:"text-muted"},_e=["onClick"],me={class:"text-muted"},fe={class:"actions-cell"},ge=["onClick"],he=["onClick"],ye={key:0,class:"pagination-bar"},ke={class:"page-info"},we={class:"page-btns"},Ce=["disabled"],xe=["onClick"],Me=["disabled"],Ve={class:"modal"},$e={class:"modal-header"},De={class:"modal-body"},Ie={class:"form-group"},Ee={class:"form-group"},Ne={class:"form-group"},Ue=["placeholder"],Be={class:"form-row"},Se={class:"form-group"},Te={class:"form-group"},Ae={class:"checkbox-label"},je={class:"form-group"},ze={class:"checkbox-label"},Fe={class:"modal-footer"},Le=["disabled"],E=10,Oe=R({__name:"ModelsView",setup(x){const i=Y(),S=Z(),p=r(!1),c=r("kiro"),M=r({}),u=r(1),v=r(!1),a=r({}),_=r(!1),f=r(!1),T=m(()=>W.map(s=>({label:X[s].name,value:s}))),g=m(()=>M.value[c.value]||[]),V=m(()=>g.value.length),$=m(()=>Math.max(1,Math.ceil(V.value/E))),A=m(()=>{const s=(u.value-1)*E;return g.value.slice(s,s+E)});function j(s){c.value=s,u.value=1}async function h(){p.value=!0;try{const s=(await w.get("/api/models/list")).data;s.code===0&&s.data&&(M.value=s.data)}catch{i.error("获取模型列表失败")}finally{p.value=!1}}function z(){_.value=!1,a.value={channel:c.value,model_id:"",name:"",owned_by:c.value,is_default:!1,enabled:!0,sort_order:g.value.length+1},v.value=!0}function F(s){_.value=!0,a.value={...s,channel:c.value},v.value=!0}async function L(){var t;const s=a.value;if(!((t=s.model_id)!=null&&t.trim())){i.warning("Model ID 不能为空");return}f.value=!0;try{const l=(await w.post("/api/models/save",{id:_.value?s.id:void 0,channel:s.channel,model_id:s.model_id,name:s.name||s.model_id,owned_by:s.owned_by||s.channel,is_default:s.is_default||!1,enabled:s.enabled!==!1,sort_order:s.sort_order||0})).data;l.code===0?(i.success(_.value?"编辑成功":"添加成功"),v.value=!1,await h()):i.error(l.msg||"保存失败")}catch{i.error("保存失败")}finally{f.value=!1}}function O(s){S.warning({title:"确认删除",content:`确定要删除模型 "${s.model_id}" 吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:async()=>{try{const t=(await w.post("/api/models/delete",{id:s.id})).data;t.code===0?(i.success("删除成功"),await h()):i.error(t.msg||"删除失败")}catch{i.error("删除失败")}}})}async function P(s){try{const t=(await w.post("/api/models/toggle",{id:s.id,enabled:!s.enabled})).data;t.code===0?s.enabled=!s.enabled:i.error(t.msg||"更新失败")}catch{i.error("更新失败")}}return G(()=>{h()}),(s,t)=>(n(),o("div",ee,[e("div",te,[t[11]||(t[11]=e("div",null,[e("h2",{class:"page-title"},"模型管理"),e("p",{class:"page-desc"},"管理各渠道支持的模型列表，支持添加、编辑、删除和启用/禁用")],-1)),e("div",le,[e("button",{onClick:h,disabled:p.value,class:"btn btn-outline"},d(p.value?"刷新中...":"刷新"),9,se),e("button",{onClick:z,class:"btn btn-primary"},"+ 添加模型")])]),e("div",ae,[(n(!0),o(D,null,I(T.value,l=>(n(),o("button",{key:l.value,onClick:y=>j(l.value),class:C(["ch-tab",{active:c.value===l.value}])},[U(d(l.label)+" ",1),e("span",ne,d((M.value[l.value]||[]).length),1)],10,oe))),128))]),e("div",de,[p.value?(n(),o("div",ie,"加载中...")):g.value.length===0?(n(),o("div",ue,'暂无模型数据，点击"添加模型"开始')):(n(),o("table",re,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",{style:{width:"50px"}},"ID"),e("th",null,"Model ID"),e("th",null,"名称"),e("th",{style:{width:"70px"}},"默认"),e("th",{style:{width:"70px"}},"状态"),e("th",{style:{width:"60px"}},"排序"),e("th",{style:{width:"130px","text-align":"center"}},"操作")])],-1)),e("tbody",null,[(n(!0),o(D,null,I(A.value,l=>(n(),o("tr",{key:l.id,class:C({"row-disabled":!l.enabled})},[e("td",ce,d(l.id),1),e("td",null,[e("code",ve,d(l.model_id),1)]),e("td",null,d(l.name||"-"),1),e("td",null,[l.is_default?(n(),o("span",be,"默认")):(n(),o("span",pe,"-"))]),e("td",null,[e("button",{onClick:y=>P(l),class:C(["toggle-btn",l.enabled?"on":"off"])},[...t[12]||(t[12]=[e("span",{class:"toggle-dot"},null,-1)])],10,_e)]),e("td",me,d(l.sort_order),1),e("td",fe,[e("button",{onClick:y=>F(l),class:"act-btn act-edit"},"编辑",8,ge),e("button",{onClick:y=>O(l),class:"act-btn act-delete"},"删除",8,he)])],2))),128))])]))]),V.value>0?(n(),o("div",ye,[e("span",ke,"共 "+d(V.value)+" 个模型",1),e("div",we,[e("button",{onClick:t[0]||(t[0]=l=>u.value=Math.max(1,u.value-1)),disabled:u.value<=1,class:"page-btn"},"<",8,Ce),(n(!0),o(D,null,I($.value,l=>(n(),o("button",{key:l,onClick:y=>u.value=l,class:C(["page-btn",{active:u.value===l}])},d(l),11,xe))),128)),e("button",{onClick:t[1]||(t[1]=l=>u.value=Math.min($.value,u.value+1)),disabled:u.value>=$.value,class:"page-btn"},">",8,Me)])])):N("",!0),v.value?(n(),o("div",{key:1,class:"modal-overlay",onClick:t[10]||(t[10]=J(l=>v.value=!1,["self"]))},[e("div",Ve,[e("div",$e,[e("h3",null,d(_.value?"编辑模型":"添加模型"),1),e("button",{onClick:t[2]||(t[2]=l=>v.value=!1),class:"modal-close"},"×")]),e("div",De,[e("div",Ie,[t[14]||(t[14]=e("label",null,[U("Model ID "),e("span",{class:"required"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.model_id=l),placeholder:"例如: claude-sonnet-4-5",class:"form-input"},null,512),[[k,a.value.model_id]])]),e("div",Ee,[t[15]||(t[15]=e("label",null,"名称",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.name=l),placeholder:"例如: Claude Sonnet 4.5",class:"form-input"},null,512),[[k,a.value.name]])]),e("div",Ne,[t[16]||(t[16]=e("label",null,"Owned By",-1)),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.owned_by=l),placeholder:c.value,class:"form-input"},null,8,Ue),[[k,a.value.owned_by]])]),e("div",Be,[e("div",Se,[t[17]||(t[17]=e("label",null,"排序",-1)),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>a.value.sort_order=l),type:"number",class:"form-input"},null,512),[[k,a.value.sort_order,void 0,{number:!0}]])]),e("div",Te,[e("label",Ae,[b(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=l=>a.value.is_default=l)},null,512),[[B,a.value.is_default]]),t[18]||(t[18]=e("span",null,"设为默认",-1))])]),e("div",je,[e("label",ze,[b(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=l=>a.value.enabled=l)},null,512),[[B,a.value.enabled]]),t[19]||(t[19]=e("span",null,"启用",-1))])])])]),e("div",Fe,[e("button",{onClick:t[9]||(t[9]=l=>v.value=!1),class:"btn btn-outline"},"取消"),e("button",{onClick:L,disabled:f.value,class:"btn btn-primary"},d(f.value?"保存中...":"保存"),9,Le)])])])):N("",!0)]))}}),Ke=Q(Oe,[["__scopeId","data-v-95556da1"]]);export{Ke as default};
