import{ah as Ce,w as re,ad as W,y as on,l as rn,F as Ae,D as ge,E as Y,k as Ie,ae as sn,S as k,T as b,O as L,J as pe,R as g,H as fe,I as Be,K as U,Y as ye,a1 as ie,a2 as ue,P as V,aN as rt,az as It,aC as St,Q,V as we,a4 as lt,o as H,G as se,$ as dt,_ as ct,a0 as ut,a6 as ht,X as At,Z as Ne,a8 as an,aO as ln,aA as dn,a3 as cn}from"./debounce-BNOmQ76Y.js";import{C as un}from"./CalloutAugment-BTDUhyqD.js";import{I as Z,T as Re}from"./Icon-CohttyM7.js";import{a as hn}from"./IconButtonAugment-DO0xxfgT.js";import{C as pn,T as mn}from"./TextTooltipAugment-CGvqFHAr.js";import{a0 as Ge,a1 as Fe,a2 as me,a3 as gn,a4 as Pt,a5 as ft,a6 as kt,a7 as $t,a8 as Nt,a9 as ze,aa as Ye,ab as Ze,ac as de,ad as fn,ae as Me,af as vn,ag as _n,ah as yn,ai as wn,aj as bn,ak as xn,al as Cn,am as Mn,an as En,D as He,ao as Tn,ap as In,aq as Ot,ar as Dt,as as Sn,at as Je,au as Lt,q as vt,av as An,aw as Pn,ax as kn,ay as Rt,az as Ft,aA as qt,aB as Ht,aC as Bt,aD as $n,aE as zt,aF as Ut,aG as Nn,a as On,aH as Dn,aI as Ln,aJ as Rn,aK as Fn,aL as qn,aM as Hn,v as Bn,b as zn,aN as Un}from"./extension-client-context-CN64fWtK.js";import{s as Kn}from"./index-C6s5m6Q5.js";import"./Chevron-DgXCK6y3.js";import"./legacy-2-VBD5Kq.js";import"./BaseTextInput-D02l0mHz.js";import{P as Xe}from"./message-broker-DUQuEFlt.js";import{F as ae}from"./Filespan-FcScXFRk.js";import{T as Gn}from"./TextCombo-CIszZzGN.js";try{Le=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},(gt=new Le.Error().stack)&&(Le._sentryDebugIds=Le._sentryDebugIds||{},Le._sentryDebugIds[gt]="32c18d6f-4eab-45d8-85fd-ef144797f816",Le._sentryDebugIdIdentifier="sentry-dbid-32c18d6f-4eab-45d8-85fd-ef144797f816")}catch{}var Le,gt,Yn=Ge.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:n}){return["p",Fe(this.options.HTMLAttributes,n),0]},parseMarkdown:(n,e)=>{const t=n.tokens||[];return t.length===1&&t[0].type==="image"?e.parseChildren([t[0]]):e.createNode("paragraph",void 0,e.parseInline(t))},renderMarkdown:(n,e)=>n&&Array.isArray(n.content)?e.renderChildren(n.content):"",addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Vn=Ge.create({name:"hardBreak",markdownTokenName:"br",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:n}){return["br",Fe(this.options.HTMLAttributes,n)]},renderText:()=>`
`,renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:n,chain:e,state:t,editor:o})=>n.first([()=>n.exitCode(),()=>n.command((()=>{const{selection:i,storedMarks:a}=t;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:r}=this.options,{splittableMarks:s}=o.extensionManager,l=a||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command((({tr:d,dispatch:u})=>{if(u&&l&&r){const c=l.filter((h=>s.includes(h.type.name)));d.ensureMarks(c)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Xn=Vn,Wn=Ge.create({name:"text",group:"inline",parseMarkdown:n=>({type:"text",text:n.text||""}),renderMarkdown:n=>n.text||""}),jn=Ge.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(n,e)=>n.content?e.renderChildren(n.content,`

`):""});function Jn(n={}){return new me({view:e=>new Qn(e,n)})}class Qn{constructor(e,t){var o;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(o=t.width)!==null&&o!==void 0?o:1,this.color=t.color===!1?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((i=>{let a=r=>{this[i](r)};return e.dom.addEventListener(i,a),{name:i,handler:a}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),o=!t.parent.inlineContent;if(o){let s=t.nodeBefore,l=t.nodeAfter;if(s||l){let d=this.editorView.nodeDOM(this.cursorPos-(s?s.nodeSize:0));if(d){let u=d.getBoundingClientRect(),c=s?u.bottom:u.top;s&&l&&(c=(c+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:u.left,right:u.right,top:c-this.width/2,bottom:c+this.width/2}}}}if(!e){let s=this.editorView.coordsAtPos(this.cursorPos);e={left:s.left-this.width/2,right:s.left+this.width/2,top:s.top,bottom:s.bottom}}let i,a,r=this.editorView.dom.offsetParent;if(this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",o),this.element.classList.toggle("prosemirror-dropcursor-inline",!o),!r||r==document.body&&getComputedStyle(r).position=="static")i=-pageXOffset,a=-pageYOffset;else{let s=r.getBoundingClientRect();i=s.left-r.scrollLeft,a=s.top-r.scrollTop}this.element.style.left=e.left-i+"px",this.element.style.top=e.top-a+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),o=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),i=o&&o.type.spec.disableDropCursor,a=typeof i=="function"?i(this.editorView,t,e):i;if(t&&!a){let r=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let s=gn(this.editorView.state.doc,r,this.editorView.dragging.slice);s!=null&&(r=s)}this.setCursor(r),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class G extends Ze{constructor(e){super(e,e)}map(e,t){let o=e.resolve(t.map(this.head));return G.valid(o)?new G(o):Ze.near(o)}content(){return kt.empty}eq(e){return e instanceof G&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if(typeof t.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new G(e.resolve(t.pos))}getBookmark(){return new pt(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!(function(a){for(let r=a.depth;r>=0;r--){let s=a.index(r),l=a.node(r);if(s!=0)for(let d=l.child(s-1);;d=d.lastChild){if(d.childCount==0&&!d.inlineContent||d.isAtom||d.type.spec.isolating)return!0;if(d.inlineContent)return!1}else if(l.type.spec.isolating)return!0}return!0})(e)||!(function(a){for(let r=a.depth;r>=0;r--){let s=a.indexAfter(r),l=a.node(r);if(s!=l.childCount)for(let d=l.child(s);;d=d.firstChild){if(d.childCount==0&&!d.inlineContent||d.isAtom||d.type.spec.isolating)return!0;if(d.inlineContent)return!1}else if(l.type.spec.isolating)return!0}return!0})(e))return!1;let o=t.type.spec.allowGapCursor;if(o!=null)return o;let i=t.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,t,o=!1){e:for(;;){if(!o&&G.valid(e))return e;let i=e.pos,a=null;for(let r=e.depth;;r--){let s=e.node(r);if(t>0?e.indexAfter(r)<s.childCount:e.index(r)>0){a=s.child(t>0?e.indexAfter(r):e.index(r)-1);break}if(r==0)return null;i+=t;let l=e.doc.resolve(i);if(G.valid(l))return l}for(;;){let r=t>0?a.firstChild:a.lastChild;if(!r){if(a.isAtom&&!a.isText&&!Nt.isSelectable(a)){e=e.doc.resolve(i+a.nodeSize*t),o=!1;continue e}break}a=r,i+=t;let s=e.doc.resolve(i);if(G.valid(s))return s}return null}}}G.prototype.visible=!1,G.findFrom=G.findGapCursorFrom,Ze.jsonID("gapcursor",G);class pt{constructor(e){this.pos=e}map(e){return new pt(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return G.valid(t)?new G(t):Ze.near(t)}}const Zn=Pt({ArrowLeft:We("horiz",-1),ArrowRight:We("horiz",1),ArrowUp:We("vert",-1),ArrowDown:We("vert",1)});function We(n,e){const t=n=="vert"?e>0?"down":"up":e>0?"right":"left";return function(o,i,a){let r=o.selection,s=e>0?r.$to:r.$from,l=r.empty;if(r instanceof $t){if(!a.endOfTextblock(t)||s.depth==0)return!1;l=!1,s=o.doc.resolve(e>0?s.after():s.before())}let d=G.findGapCursorFrom(s,e,l);return!!d&&(i&&i(o.tr.setSelection(new G(d))),!0)}}function eo(n,e,t){if(!n||!n.editable)return!1;let o=n.state.doc.resolve(e);if(!G.valid(o))return!1;let i=n.posAtCoords({left:t.clientX,top:t.clientY});return!(i&&i.inside>-1&&Nt.isSelectable(n.state.doc.nodeAt(i.inside)))&&(n.dispatch(n.state.tr.setSelection(new G(o))),!0)}function to(n,e){if(e.inputType!="insertCompositionText"||!(n.state.selection instanceof G))return!1;let{$from:t}=n.state.selection,o=t.parent.contentMatchAt(t.index()).findWrapping(n.state.schema.nodes.text);if(!o)return!1;let i=ft.empty;for(let r=o.length-1;r>=0;r--)i=ft.from(o[r].createAndFill(null,i));let a=n.state.tr.replace(t.pos,t.pos,new kt(i,0,0));return a.setSelection($t.near(a.doc.resolve(t.pos+1))),n.dispatch(a),!1}function no(n){if(!(n.selection instanceof G))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",ze.create(n.doc,[Ye.widget(n.selection.head,e,{key:"gapcursor"})])}var et=200,J=function(){};J.prototype.append=function(n){return n.length?(n=J.from(n),!this.length&&n||n.length<et&&this.leafAppend(n)||this.length<et&&n.leafPrepend(this)||this.appendInner(n)):this},J.prototype.prepend=function(n){return n.length?J.from(n).append(this):this},J.prototype.appendInner=function(n){return new oo(this,n)},J.prototype.slice=function(n,e){return n===void 0&&(n=0),e===void 0&&(e=this.length),n>=e?J.empty:this.sliceInner(Math.max(0,n),Math.min(this.length,e))},J.prototype.get=function(n){if(!(n<0||n>=this.length))return this.getInner(n)},J.prototype.forEach=function(n,e,t){e===void 0&&(e=0),t===void 0&&(t=this.length),e<=t?this.forEachInner(n,e,t,0):this.forEachInvertedInner(n,e,t,0)},J.prototype.map=function(n,e,t){e===void 0&&(e=0),t===void 0&&(t=this.length);var o=[];return this.forEach((function(i,a){return o.push(n(i,a))}),e,t),o},J.from=function(n){return n instanceof J?n:n&&n.length?new Kt(n):J.empty};var Kt=(function(n){function e(o){n.call(this),this.values=o}n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(o,i){return o==0&&i==this.length?this:new e(this.values.slice(o,i))},e.prototype.getInner=function(o){return this.values[o]},e.prototype.forEachInner=function(o,i,a,r){for(var s=i;s<a;s++)if(o(this.values[s],r+s)===!1)return!1},e.prototype.forEachInvertedInner=function(o,i,a,r){for(var s=i-1;s>=a;s--)if(o(this.values[s],r+s)===!1)return!1},e.prototype.leafAppend=function(o){if(this.length+o.length<=et)return new e(this.values.concat(o.flatten()))},e.prototype.leafPrepend=function(o){if(this.length+o.length<=et)return new e(o.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e})(J);J.empty=new Kt([]);var oo=(function(n){function e(t,o){n.call(this),this.left=t,this.right=o,this.length=t.length+o.length,this.depth=Math.max(t.depth,o.depth)+1}return n&&(e.__proto__=n),e.prototype=Object.create(n&&n.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,o,i,a){var r=this.left.length;return!(o<r&&this.left.forEachInner(t,o,Math.min(i,r),a)===!1)&&!(i>r&&this.right.forEachInner(t,Math.max(o-r,0),Math.min(this.length,i)-r,a+r)===!1)&&void 0},e.prototype.forEachInvertedInner=function(t,o,i,a){var r=this.left.length;return!(o>r&&this.right.forEachInvertedInner(t,o-r,Math.max(i,r)-r,a+r)===!1)&&!(i<r&&this.left.forEachInvertedInner(t,Math.min(o,r),i,a)===!1)&&void 0},e.prototype.sliceInner=function(t,o){if(t==0&&o==this.length)return this;var i=this.left.length;return o<=i?this.left.slice(t,o):t>=i?this.right.slice(t-i,o-i):this.left.slice(t,i).append(this.right.slice(0,o-i))},e.prototype.leafAppend=function(t){var o=this.right.leafAppend(t);if(o)return new e(this.left,o)},e.prototype.leafPrepend=function(t){var o=this.left.leafPrepend(t);if(o)return new e(o,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e})(J);class he{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(this.eventCount==0)return null;let o,i,a=this.items.length;for(;;a--)if(this.items.get(a-1).selection){--a;break}t&&(o=this.remapping(a,this.items.length),i=o.maps.length);let r,s,l=e.tr,d=[],u=[];return this.items.forEach(((c,h)=>{if(!c.step)return o||(o=this.remapping(a,h+1),i=o.maps.length),i--,void u.push(c);if(o){u.push(new _e(c.map));let m,_=c.step.map(o.slice(i));_&&l.maybeStep(_).doc&&(m=l.mapping.maps[l.mapping.maps.length-1],d.push(new _e(m,void 0,void 0,d.length+u.length))),i--,m&&o.appendMap(m,i)}else l.maybeStep(c.step);return c.selection?(r=o?c.selection.map(o.slice(i)):c.selection,s=new he(this.items.slice(0,a).append(u.reverse().concat(d)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:s,transform:l,selection:r}}addTransform(e,t,o,i){let a=[],r=this.eventCount,s=this.items,l=!i&&s.length?s.get(s.length-1):null;for(let u=0;u<e.steps.length;u++){let c,h=e.steps[u].invert(e.docs[u]),m=new _e(e.mapping.maps[u],h,t);(c=l&&l.merge(m))&&(m=c,u?a.pop():s=s.slice(0,s.length-1)),a.push(m),t&&(r++,t=void 0),i||(l=m)}let d=r-o.depth;return d>io&&(s=(function(u,c){let h;return u.forEach(((m,_)=>{if(m.selection&&c--==0)return h=_,!1})),u.slice(h)})(s,d),r-=d),new he(s.append(a),r)}remapping(e,t){let o=new fn;return this.items.forEach(((i,a)=>{let r=i.mirrorOffset!=null&&a-i.mirrorOffset>=e?o.maps.length-i.mirrorOffset:void 0;o.appendMap(i.map,r)}),e,t),o}addMaps(e){return this.eventCount==0?this:new he(this.items.append(e.map((t=>new _e(t)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let o=[],i=Math.max(0,this.items.length-t),a=e.mapping,r=e.steps.length,s=this.eventCount;this.items.forEach((h=>{h.selection&&s--}),i);let l=t;this.items.forEach((h=>{let m=a.getMirror(--l);if(m==null)return;r=Math.min(r,m);let _=a.maps[m];if(h.step){let M=e.steps[m].invert(e.docs[m]),y=h.selection&&h.selection.map(a.slice(l+1,m));y&&s++,o.push(new _e(_,M,y))}else o.push(new _e(_))}),i);let d=[];for(let h=t;h<r;h++)d.push(new _e(a.maps[h]));let u=this.items.slice(0,i).append(d).append(o),c=new he(u,s);return c.emptyItemCount()>500&&(c=c.compress(this.items.length-o.length)),c}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),o=t.maps.length,i=[],a=0;return this.items.forEach(((r,s)=>{if(s>=e)i.push(r),r.selection&&a++;else if(r.step){let l=r.step.map(t.slice(o)),d=l&&l.getMap();if(o--,d&&t.appendMap(d,o),l){let u=r.selection&&r.selection.map(t.slice(o));u&&a++;let c,h=new _e(d.invert(),l,u),m=i.length-1;(c=i.length&&i[m].merge(h))?i[m]=c:i.push(h)}}else r.map&&o--}),this.items.length,0),new he(J.from(i.reverse()),a)}}he.empty=new he(J.empty,0);class _e{constructor(e,t,o,i){this.map=e,this.step=t,this.selection=o,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new _e(t.getMap().invert(),t,this.selection)}}}class Te{constructor(e,t,o,i,a){this.done=e,this.undone=t,this.prevRanges=o,this.prevTime=i,this.prevComposition=a}}const io=20;function _t(n){let e=[];for(let t=n.length-1;t>=0&&e.length==0;t--)n[t].forEach(((o,i,a,r)=>e.push(a,r)));return e}function st(n,e){if(!n)return null;let t=[];for(let o=0;o<n.length;o+=2){let i=e.map(n[o],1),a=e.map(n[o+1],-1);i<=a&&t.push(i,a)}return t}let at=!1,yt=null;function Qe(n){let e=n.plugins;if(yt!=e){at=!1,yt=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){at=!0;break}}return at}const $e=new de("history"),ro=new de("closeHistory");function so(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new me({key:$e,state:{init:()=>new Te(he.empty,he.empty,null,0,-1),apply:(e,t,o)=>(function(i,a,r,s){let l,d=r.getMeta($e);if(d)return d.historyState;r.getMeta(ro)&&(i=new Te(i.done,i.undone,null,0,-1));let u=r.getMeta("appendedTransaction");if(r.steps.length==0)return i;if(u&&u.getMeta($e))return u.getMeta($e).redo?new Te(i.done.addTransform(r,void 0,s,Qe(a)),i.undone,_t(r.mapping.maps),i.prevTime,i.prevComposition):new Te(i.done,i.undone.addTransform(r,void 0,s,Qe(a)),null,i.prevTime,i.prevComposition);if(r.getMeta("addToHistory")===!1||u&&u.getMeta("addToHistory")===!1)return(l=r.getMeta("rebased"))?new Te(i.done.rebased(r,l),i.undone.rebased(r,l),st(i.prevRanges,r.mapping),i.prevTime,i.prevComposition):new Te(i.done.addMaps(r.mapping.maps),i.undone.addMaps(r.mapping.maps),st(i.prevRanges,r.mapping),i.prevTime,i.prevComposition);{let c=r.getMeta("composition"),h=i.prevTime==0||!u&&i.prevComposition!=c&&(i.prevTime<(r.time||0)-s.newGroupDelay||!(function(_,M){if(!M)return!1;if(!_.docChanged)return!0;let y=!1;return _.mapping.maps[0].forEach(((f,p)=>{for(let w=0;w<M.length;w+=2)f<=M[w+1]&&p>=M[w]&&(y=!0)})),y})(r,i.prevRanges)),m=u?st(i.prevRanges,r.mapping):_t(r.mapping.maps);return new Te(i.done.addTransform(r,h?a.selection.getBookmark():void 0,s,Qe(a)),he.empty,m,r.time,c??i.prevComposition)}})(t,o,e,n)},config:n,props:{handleDOMEvents:{beforeinput(e,t){let o=t.inputType,i=o=="historyUndo"?Yt:o=="historyRedo"?Vt:null;return!(!i||!e.editable)&&(t.preventDefault(),i(e.state,e.dispatch))}}}})}function Gt(n,e){return(t,o)=>{let i=$e.getState(t);if(!i||(n?i.undone:i.done).eventCount==0)return!1;if(o){let a=(function(r,s,l){let d=Qe(s),u=$e.get(s).spec.config,c=(l?r.undone:r.done).popEvent(s,d);if(!c)return null;let h=c.selection.resolve(c.transform.doc),m=(l?r.done:r.undone).addTransform(c.transform,s.selection.getBookmark(),u,d),_=new Te(l?m:c.remaining,l?c.remaining:m,null,0,-1);return c.transform.setSelection(h).setMeta($e,{redo:l,historyState:_})})(i,t,n);a&&o(e?a.scrollIntoView():a)}return!0}}const Yt=Gt(!1,!0),Vt=Gt(!0,!0);Me.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter((e=>e!=="")).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=n=>{const e=n?.node||this.editor.state.doc;if((n?.mode||this.options.mode)==="textSize"){const t=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(t)}return e.nodeSize},this.storage.words=n=>{const e=n?.node||this.editor.state.doc,t=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(t)}},addProseMirrorPlugins(){let n=!1;return[new me({key:new de("characterCount"),appendTransaction:(e,t,o)=>{if(n)return;const i=this.options.limit;if(i==null||i===0)return void(n=!0);const a=this.storage.characters({node:o.doc});if(a>i){const s=a-i;console.warn(`[CharacterCount] Initial content exceeded limit of ${i} characters. Content was automatically trimmed.`);const l=o.tr.deleteRange(0,s);return n=!0,l}n=!0},filterTransaction:(e,t)=>{const o=this.options.limit;if(!e.docChanged||o===0||o==null)return!0;const i=this.storage.characters({node:t.doc}),a=this.storage.characters({node:e.doc});if(a<=o||i>o&&a>o&&a<=i)return!0;if(i>o&&a>o&&a>i||!e.getMeta("paste"))return!1;const r=e.selection.$head.pos,s=r-(a-o),l=r;return e.deleteRange(s,l),!(this.storage.characters({node:e.doc})>o)}})]}}),Me.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[Jn(this.options)]}}),Me.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new me({key:new de("focus"),props:{decorations:({doc:n,selection:e})=>{const{isEditable:t,isFocused:o}=this.editor,{anchor:i}=e,a=[];if(!t||!o)return ze.create(n,[]);let r=0;this.options.mode==="deepest"&&n.descendants(((l,d)=>{if(!l.isText){if(!(i>=d&&i<=d+l.nodeSize-1))return!1;r+=1}}));let s=0;return n.descendants(((l,d)=>{if(l.isText||!(i>=d&&i<=d+l.nodeSize-1))return!1;if(s+=1,this.options.mode==="deepest"&&r-s>0||this.options.mode==="shallowest"&&s>1)return this.options.mode==="deepest";a.push(Ye.node(d,d+l.nodeSize,{class:this.options.className}))})),ze.create(n,a)}}})]}}),Me.create({name:"gapCursor",addProseMirrorPlugins:()=>[new me({props:{decorations:no,createSelectionBetween:(n,e,t)=>e.pos==t.pos&&G.valid(t)?new G(t):null,handleClick:eo,handleKeyDown:Zn,handleDOMEvents:{beforeinput:to}}})],extendNodeSchema(n){var e;const t={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(e=vn(_n(n,"allowGapCursor",t)))!=null?e:null}}});var ao=Me.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new me({key:new de("placeholder"),props:{decorations:({doc:n,selection:e})=>{const t=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:o}=e,i=[];if(!t)return null;const a=this.editor.isEmpty;return n.descendants(((r,s)=>{const l=o>=s&&o<=s+r.nodeSize,d=!r.isLeaf&&yn(r);if((l||!this.options.showOnlyCurrent)&&d){const u=[this.options.emptyNodeClass];a&&u.push(this.options.emptyEditorClass);const c=Ye.node(s,s+r.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:r,pos:s,hasAnchor:l}):this.options.placeholder});i.push(c)}return this.options.includeChildren})),ze.create(n,i)}}})]}});function wt({types:n,node:e}){return e&&Array.isArray(n)&&n.includes(e.type)||e?.type===n}Me.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){const{editor:n,options:e}=this;return[new me({key:new de("selection"),props:{decorations:t=>t.selection.empty||n.isFocused||!n.isEditable||wn(t.selection)||n.view.dragging?null:ze.create(t.doc,[Ye.inline(t.selection.from,t.selection.to,{class:e.className})])}})]}}),Me.create({name:"trailingNode",addOptions:()=>({node:void 0,notAfter:[]}),addProseMirrorPlugins(){var n;const e=new de(this.name),t=this.options.node||((n=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:n.name)||"paragraph",o=Object.entries(this.editor.schema.nodes).map((([,i])=>i)).filter((i=>(this.options.notAfter||[]).concat(t).includes(i.name)));return[new me({key:e,appendTransaction:(i,a,r)=>{const{doc:s,tr:l,schema:d}=r,u=e.getState(r),c=s.content.size,h=d.nodes[t];if(u)return l.insert(c,h.create())},state:{init:(i,a)=>!wt({node:a.tr.doc.lastChild,types:o}),apply:(i,a)=>!i.docChanged||i.getMeta("__uniqueIDTransaction")?a:!wt({node:i.doc.lastChild,types:o})}})]}});var lo=Me.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:n,dispatch:e})=>Yt(n,e),redo:()=>({state:n,dispatch:e})=>Vt(n,e)}),addProseMirrorPlugins(){return[so(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}});class co{constructor(e){this._opts=e,this._defaultPlugins=Ce(this._opts,this._getDefaultPlugins),this._allPlugins=Ce([this._defaultPlugins,this._registeredPlugins],(([t,o])=>[...t,...o]))}_registeredPlugins=re([]);_defaultPlugins;_allPlugins;_getDefaultPlugins=e=>[jn.extend({addKeyboardShortcuts:()=>({...e.keyboardShortcuts})}),Yn,Wn,Xn,lo.configure({depth:100})].map((t=>({tipTapExtension:t})));registerPlugin=e=>(this._registeredPlugins.update((t=>[...t,e])),()=>{this._registeredPlugins.update((t=>t.filter((o=>o!==e))))});onPluginsChanged=e=>this._allPlugins.subscribe(e);get tipTapExtensions(){return W(this._allPlugins).map((e=>e.tipTapExtension))}}function hi(n,e,t){let o;return o=n.selection.empty?n.selection.anchor:Math.min(n.selection.anchor,n.selection.head),{prefix:n.doc.textBetween(0,o,e,t),offsetStart:0,offsetEnd:o}}function pi(n,e,t){let o;return o=n.selection.empty?n.selection.anchor:Math.min(n.selection.anchor,n.selection.head),{suffix:n.doc.textBetween(o,n.doc.nodeSize-2,e,t),offsetStart:o,offsetEnd:n.doc.nodeSize-2}}function bt(n){return n.length===0?[]:[{type:"text",text:n}]}function xt(n){if(n!==void 0){if(typeof n=="string"){const e=n.split(`
`).map(((t,o)=>o===0?bt(t):[{type:"hardBreak"},...bt(t)])).flat();return e.length>0?e:void 0}return Array.isArray(n)?n.length>0?n:void 0:n}}class uo{constructor(e){this._opts=e}_setupFns=[];_editor;registerEditor=e=>{this._editor=e,this._runSetupFns()};unregisterEditor=()=>{this._editor=void 0};can=()=>this._editor?.can();chain=()=>this._editor?.chain();get commands(){return this._editor?.commands}_queueOrRun=e=>{this._editor?e():this._setupFns.push(e)};_runSetupFns=()=>{this._setupFns.forEach((e=>{e()})),this._setupFns=[]};hide=()=>this._queueOrRun(this._hide);show=()=>this._queueOrRun(this._show);focus=()=>this._queueOrRun(this._focus);requestFocus=()=>this._queueOrRun(this._requestFocus);blur=()=>this._queueOrRun(this._blur);scrollToCursor=()=>this._queueOrRun(this._scrollToCursor);setEditable=e=>this._queueOrRun((()=>this._setEditable(e)));clearContent=()=>this._queueOrRun(this._clearContent);setContent=(e,t)=>this._queueOrRun((()=>this._setContent(e,t)));insertContent=e=>this._queueOrRun((()=>this._insertContent(e)));_hide=()=>{this._editor&&(this._editor.view.dom.style.display="none")};_show=()=>{this._editor&&this._editor.view.dom.style.removeProperty("display")};_focus=()=>this._editor?.commands.focus();_requestFocus=async()=>{await on(),this._editor&&this._editor.commands.focus()};_blur=()=>this._editor?.commands.blur();_scrollToCursor=()=>this._editor?.commands.scrollIntoView();_setEditable=e=>{this._editor?.setEditable(e),e&&this._editor?.commands.setTextSelection(this._editor.state.doc.content.size)};_clearContent=()=>{const e=W(this._opts.content);e&&e.rawText!==""&&this._editor?.commands.clearContent(!0)};_setContent=(e,t)=>{const o=W(this._opts.content);e===o?.rawText||e===o?.richTextJsonRepr||((e=xt(e??[]))!==void 0?this._editor?.chain().setContent(e,{emitUpdate:!0,parseOptions:{preserveWhitespace:!0}}).setTextSelection(t?.cursorPosition==="start"?0:1e20).run():this._clearContent())};_insertContent=e=>{const t=xt(e);t!==void 0&&this._editor?.commands.insertContent(t,{parseOptions:{preserveWhitespace:!0}})}}class ho{_isFocused=re(!1);_isEditable=re(!1);_content=re(void 0);_disposers=[];_isFooterClicked=!1;_footerClickTimeout;_footerAwareFocused=re(!1);registerEditor=e=>{this._isFocused.set(e.isFocused),this._isEditable.set(e.isEditable),this._content.set({richTextJsonRepr:e.getJSON(),rawText:e.getText()}),this._footerAwareFocused.set(e.isFocused);const t=()=>{this._isFocused.set(!0),this._isFooterClicked||this._footerAwareFocused.set(!0)},o=()=>{rn((()=>{this._isFocused.set(!1),this._isFooterClicked||this._footerAwareFocused.set(!1)}))},i=()=>this._isEditable.set(e.isEditable),a=()=>{this._content.set({richTextJsonRepr:e.getJSON(),rawText:e.getText()})};e.on("focus",t),e.on("blur",o),e.on("update",i),e.on("update",a),this._disposers.push((()=>e.off("focus",t)),(()=>e.off("blur",o)),(()=>e.off("update",i)),(()=>e.off("update",a)))};unregisterEditor=()=>{this._isFocused.set(!1),this._isEditable.set(!1),this._footerAwareFocused.set(!1),this._footerClickTimeout&&(clearTimeout(this._footerClickTimeout),this._footerClickTimeout=void 0),this._disposers.forEach((e=>e())),this._disposers=[]};handleFooterClick=()=>{this._isFooterClicked=!0,this._footerClickTimeout&&clearTimeout(this._footerClickTimeout),this._footerClickTimeout=setTimeout((()=>{this._isFooterClicked=!1,this._footerClickTimeout=void 0}),200)};onFocus=e=>this.onFocusChanged((t=>{t&&e()}));onBlur=e=>this.onFocusChanged((t=>{t||e()}));onFocusChanged=e=>this._isFocused.subscribe(e);onEditableChanged=e=>this._isEditable.subscribe(e);onContentChanged=e=>this._content.subscribe((t=>t&&e(t)));get isFocused(){return this._isFocused}get footerAwareFocused(){return this._footerAwareFocused}get isEditable(){return this._isEditable}get content(){return this._content}}class le{static CONTEXT_KEY="augment-rich-text-editor";static INSTANCE_IDX=0;static _getNextInstanceIdx=()=>le.INSTANCE_IDX++;_opts=re({});_editor=void 0;_rootNode=void 0;pluginManager=new co(this._opts);eventManager=new ho;commandManager=new uo({content:this.eventManager.content});instanceId=`augment-rich-text-editor-${le._getNextInstanceIdx()}`;constructor(){this.pluginManager.onPluginsChanged(this._reinitializeEditor)}registerRoot=(e,t)=>(this._destroyEditor(),this._rootNode=e,this._opts.set(t),this._initializeEditor(),{update:o=>{this._opts.set(o)},destroy:()=>{this._destroyEditor()}});get rootNode(){return this._editor?.view.dom}get editor(){return this._editor}_registerEditorWithManagers=e=>{this.eventManager.registerEditor(e),this.commandManager.registerEditor(e)};_unregisterEditorFromManagers=()=>{this.commandManager.unregisterEditor(),this.eventManager.unregisterEditor()};_reinitializeEditor=()=>{const e=W(this.eventManager.content);this._destroyEditor(),this._initializeEditor(),e!==void 0&&this.commandManager.setContent(e.richTextJsonRepr)};_initializeEditor=()=>{if(this._rootNode===void 0||this._editor!==void 0)return;const e=W(this._opts),t={element:document.createElement("div"),editable:e.editable??!0,injectCSS:!0,extensions:this.pluginManager.tipTapExtensions,onCreate:({editor:o})=>{this._registerEditorWithManagers(o),W(this._opts).focusOnInit&&this.commandManager.focus();const i=this._attachCopyHandler();o.on("destroy",i);const a=W(this._opts).onFocus;a&&o.on("focus",a);const r=W(this._opts).onBlur;r&&o.on("blur",r)},onDestroy:()=>{this._unregisterEditorFromManagers()},onSelectionUpdate:()=>{(W(this._opts).editable??1)&&this.commandManager.scrollToCursor()},editorProps:{handlePaste:(o,i)=>{if(this._isEventFromRichTextEditor(i))return!1;const a=i.clipboardData?.getData("text/plain");return!!a&&(this.commandManager.insertContent(a),!0)},attributes:{style:"min-height: 100%; outline: none;","data-testid":"design-system-rich-text-editor-tiptap"}}};return this._editor=new bn(t),this._rootNode.appendChild(this._editor.view.dom),this._rootNode.addEventListener("keydown",(o=>{o.key==="z"&&o.metaKey===!0&&o.stopPropagation()})),this._editor};_attachCopyHandler=()=>(this._rootNode?.addEventListener("copy",this._copyHandler),this._rootNode?.addEventListener("cut",this._copyHandler),()=>{this._rootNode?.removeEventListener("copy",this._copyHandler),this._rootNode?.removeEventListener("cut",this._copyHandler)});_copyHandler=e=>{e.clipboardData?.setData("application/x-augment/rich-text","true")};_isEventFromRichTextEditor=e=>e.clipboardData?.getData("application/x-augment/rich-text")==="true";_destroyEditor=()=>{this._unregisterEditorFromManagers(),this._editor?.view.dom.remove(),this._editor?.destroy(),this._editor=void 0}}function mi(){const n=Ae(le.CONTEXT_KEY);if(!n)throw new Error(`No editor context '${le.CONTEXT_KEY}' found.`);return n}var po=U('<div class="paste-error-container svelte-1pdsp8g"><!></div>'),mo=U('<div class="c-rich-text-editor-augment__banner svelte-1pglayp"><!></div>'),go=U('<div class="c-rich-text-editor-augment__active-button svelte-1pglayp"><!></div>'),fo=U('<div class="c-rich-text-editor-augment__footer-wrapper svelte-1pglayp"><!></div>'),vo=U('<div class="l-rich-text-editor-augment svelte-1pglayp" role="button" tabindex="-1"><!> <div class="c-rich-text-editor-augment__editor svelte-1pglayp"><!></div>  <!></div>'),_o=U("<!> <!> <!>",1),yo=U("<div><!></div>");It(["keydown","click","dblclick","mousedown"]);const gi={Content:function(n,e){ge(e,!0);const[t,o]=Be(),i=Y(e,"onContentChanged",3,(()=>{})),a=Y(e,"content",3,""),r=re(!1),s=re(""),l=Ae(le.CONTEXT_KEY);let d;Ie((()=>{l.commandManager.setContent(a())})),Ie((()=>{if(i())return l.eventManager.onContentChanged(i())})),sn((()=>{let m;return d=(function(_={}){const M=_.maxPasteSize??1e5,y=_.onExceedsPasteLimit,f=function(p){const w=p.clipboardData||window.clipboardData;if(!w)return;const x=w.getData("text/plain");!x||x.length<=M||(p.preventDefault(),console.warn(`Paste operation blocked: Content exceeds ${M} character limit (${x.length} characters)`),y&&y(x.length,M))};return document.addEventListener("paste",f,!0),()=>{document.removeEventListener("paste",f,!0)}})({onExceedsPasteLimit:(_,M)=>{rt(s,`Cannot paste: Content exceeds ${M.toLocaleString()} character limit (${_.toLocaleString()} characters)`),rt(r,!0),m&&clearTimeout(m),m=window.setTimeout((()=>{rt(r,!1)}),3e3)}}),()=>{d?.(),clearTimeout(m)}}));var u=k(),c=b(u),h=m=>{var _=po(),M=V(_);un(M,{variant:"soft",color:"error",size:1,icon:f=>{Z(f,{name:"circle-alert"})},children:(f,p)=>{var w=ye();ie((()=>ue(w,pe(s,"$pasteErrorMessage",t)))),g(f,w)},$$slots:{icon:!0,default:!0}}),g(m,_)};L(c,(m=>{pe(r,"$showPasteError",t)&&m(h)})),g(n,u),fe(),o()},Root:function(n,e){ge(e,!0);const[t,o]=Be();let i=Y(e,"alwaysShowBorder",3,!1),a=Y(e,"size",3,1),r=Y(e,"variant",3,"default"),s=Y(e,"showActionButton",3,!1);const l=new le;St(le.CONTEXT_KEY,l),e.focusOnInit&&l.commandManager.requestFocus();const d=()=>l.commandManager.focus(),u=l.eventManager.footerAwareFocused,c=se((()=>pe(u,"$footerAwareFocusedStore",t)));function h(){l.eventManager.handleFooterClick()}var m={requestFocus:()=>l.commandManager.requestFocus(),forceFocus:d,blur:()=>l.commandManager.blur(),clearContent:()=>l.commandManager.clearContent(),isFocused:()=>l.eventManager.footerAwareFocused,getEditor:()=>l.editor},_=yo();let M;var y=V(_);pn(y,{class:"c-rich-text-editor-augment__card",insetContent:!0,variant:"ghost",get size(){return a()},children:(p,w)=>{var x=_o(),B=b(x),C=T=>{var A=k(),I=b(A);we(I,(()=>e.overlay)),g(T,A)};L(B,(T=>{e.overlay&&T(C)}));var $=Q(B,2),S=T=>{var A=mo(),I=V(A);we(I,(()=>e.banner)),g(T,A)};L($,(T=>{e.banner&&T(S)}));var F=Q($,2),E=T=>{var A=k(),I=b(A),v=O=>{var q=go(),D=V(q);we(D,(()=>e.activeButton)),g(O,q)};L(I,(O=>{e.activeButton&&O(v)})),g(T,A)},N=T=>{var A=vo();A.__keydown=d,A.__click=R=>{e.onclick?.(R),d()},A.__dblclick=()=>{e.ondblclick?.()};var I=V(A),v=R=>{var P=k(),z=b(P);we(z,(()=>e.header)),g(R,P)};L(I,(R=>{e.header&&R(v)}));var O=Q(I,2),q=V(O),D=R=>{var P=k(),z=b(P);we(z,(()=>e.children)),g(R,P)};L(q,(R=>{e.children&&R(D)})),hn(O,((R,P)=>l.registerRoot?.(R,P)),(()=>({editable:e.editable,focusOnInit:e.focusOnInit,onFocus:e.onFocus,onBlur:e.onBlur})));var X=Q(O,2),K=R=>{var P=fo();P.__click=h,P.__mousedown=h;var z=V(P);we(z,(()=>e.footer)),g(R,P)};L(X,(R=>{e.footer&&R(K)})),g(T,A)};L(F,(T=>{s()?T(E):T(N,!1)})),g(p,x)},$$slots:{default:!0}}),ie((()=>M=lt(_,1,`c-rich-text-editor-augment c-rich-text-editor-augment--${r()}`,"svelte-1pglayp",M,{"c-rich-text-editor-augment--editable":e.editable,"c-rich-text-editor-augment--focused":H(c),"c-rich-text-editor-augment--always-show-border":i()}))),g(n,_);var f=fe(m);return o(),f}};function wo(n){var e;const{char:t,allowSpaces:o,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:r,$position:s}=n,l=o&&!i,d=xn(t),u=new RegExp(`\\s${d}$`),c=r?"^":"",h=i?"":d,m=l?new RegExp(`${c}${d}.*?(?=\\s${h}|$)`,"gm"):new RegExp(`${c}(?:^)?${d}[^\\s${h}]*`,"gm"),_=((e=s.nodeBefore)==null?void 0:e.isText)&&s.nodeBefore.text;if(!_)return null;const M=s.pos-_.length,y=Array.from(_.matchAll(m)).pop();if(!y||y.input===void 0||y.index===void 0)return null;const f=y.input.slice(Math.max(0,y.index-1),y.index),p=new RegExp(`^[${a?.join("")}\0]?$`).test(f);if(a!==null&&!p)return null;const w=M+y.index;let x=w+y[0].length;return l&&u.test(_.slice(x-1,x+1))&&(y[0]+=" ",x+=1),w<s.pos&&x>=s.pos?{range:{from:w,to:x},query:y[0].slice(t.length),text:y[0]}:null}var bo=new de("suggestion");function xo({pluginKey:n=bo,editor:e,char:t="@",allowSpaces:o=!1,allowToIncludeChar:i=!1,allowedPrefixes:a=[" "],startOfLine:r=!1,decorationTag:s="span",decorationClass:l="suggestion",decorationContent:d="",decorationEmptyClass:u="is-empty",command:c=(()=>null),items:h=(()=>[]),render:m=(()=>({})),allow:_=(()=>!0),findSuggestionMatch:M=wo,shouldShow:y}){let f;const p=m?.(),w=()=>{const C=e.state.selection.$anchor.pos,$=e.view.coordsAtPos(C),{top:S,right:F,bottom:E,left:N}=$;try{return new DOMRect(N,S,F-N,E-S)}catch{return null}},x=(C,$)=>$?()=>{const S=n.getState(e.state),F=S?.decorationId,E=C.dom.querySelector(`[data-decoration-id="${F}"]`);return E?.getBoundingClientRect()||null}:w,B=new me({key:n,view(){return{update:async(C,$)=>{var S,F,E,N,T,A,I;const v=(S=this.key)==null?void 0:S.getState($),O=(F=this.key)==null?void 0:F.getState(C.state),q=v.active&&O.active&&v.range.from!==O.range.from,D=!v.active&&O.active,X=v.active&&!O.active,K=!D&&!X&&v.query!==O.query,R=D||q&&K,P=K||q,z=X||q&&K;if(!R&&!P&&!z)return;const ee=z&&!R?v:O,te=C.dom.querySelector(`[data-decoration-id="${ee.decorationId}"]`);f={editor:e,range:ee.range,query:ee.query,text:ee.text,items:[],command:oe=>c({editor:e,range:ee.range,props:oe}),decorationNode:te,clientRect:x(C,te)},R&&((E=p?.onBeforeStart)==null||E.call(p,f)),P&&((N=p?.onBeforeUpdate)==null||N.call(p,f)),(P||R)&&(f.items=await h({editor:e,query:ee.query})),z&&((T=p?.onExit)==null||T.call(p,f)),P&&((A=p?.onUpdate)==null||A.call(p,f)),R&&((I=p?.onStart)==null||I.call(p,f))},destroy:()=>{var C;f&&((C=p?.onExit)==null||C.call(p,f))}}},state:{init:()=>({active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}),apply(C,$,S,F){const{isEditable:E}=e,{composing:N}=e.view,{selection:T}=C,{empty:A,from:I}=T,v={...$},O=C.getMeta(n);if(O&&O.exit)return v.active=!1,v.decorationId=null,v.range={from:0,to:0},v.query=null,v.text=null,v;if(v.composing=N,E&&(A||e.view.composing)){!(I<$.range.from||I>$.range.to)||N||$.composing||(v.active=!1);const q=M({char:t,allowSpaces:o,allowToIncludeChar:i,allowedPrefixes:a,startOfLine:r,$position:T.$from}),D=`id_${Math.floor(4294967295*Math.random())}`;q&&_({editor:e,state:F,range:q.range,isActive:$.active})&&(!y||y({editor:e,range:q.range,query:q.query,text:q.text,transaction:C}))?(v.active=!0,v.decorationId=$.decorationId?$.decorationId:D,v.range=q.range,v.query=q.query,v.text=q.text):v.active=!1}else v.active=!1;return v.active||(v.decorationId=null,v.range={from:0,to:0},v.query=null,v.text=null),v}},props:{handleKeyDown(C,$){var S,F,E,N;const{active:T,range:A}=B.getState(C.state);if(!T)return!1;if($.key==="Escape"||$.key==="Esc"){const I=B.getState(C.state),v=(S=f?.decorationNode)!=null?S:null,O=v??(I?.decorationId?C.dom.querySelector(`[data-decoration-id="${I.decorationId}"]`):null);if((F=p?.onKeyDown)!=null&&F.call(p,{view:C,event:$,range:I.range}))return!0;const q={editor:e,range:I.range,query:I.query,text:I.text,items:[],command:D=>c({editor:e,range:I.range,props:D}),decorationNode:O,clientRect:O?()=>O.getBoundingClientRect()||null:null};return(E=p?.onExit)==null||E.call(p,q),(function(D,X){var K;try{const P=n.getState(D.state),z=P?.decorationId?D.dom.querySelector(`[data-decoration-id="${P.decorationId}"]`):null,ee={editor:e,range:P?.range||{from:0,to:0},query:P?.query||null,text:P?.text||null,items:[],command:te=>c({editor:e,range:P?.range||{from:0,to:0},props:te}),decorationNode:z,clientRect:x(D,z)};(K=p?.onExit)==null||K.call(p,ee)}catch{}const R=D.state.tr.setMeta(X,{exit:!0});D.dispatch(R)})(C,n),!0}return((N=p?.onKeyDown)==null?void 0:N.call(p,{view:C,event:$,range:A}))||!1},decorations(C){const{active:$,range:S,decorationId:F,query:E}=B.getState(C);if(!$)return null;const N=!E?.length,T=[l];return N&&T.push(u),ze.create(C.doc,[Ye.inline(S.from,S.to,{nodeName:s,class:T.join(" "),"data-decoration-id":F,"data-decoration-content":d})])}}});return B}function Xt(n){return(n.options.suggestions.length?n.options.suggestions:[n.options.suggestion]).map((e=>(function({editor:t,overrideSuggestionOptions:o,extensionName:i,char:a="@"}){const r=new de;return{editor:t,char:a,pluginKey:r,command:({editor:s,range:l,props:d})=>{var u,c,h;const m=s.view.state.selection.$to.nodeAfter;(u=m?.text)!=null&&u.startsWith(" ")&&(l.to+=1),s.chain().focus().insertContentAt(l,[{type:i,attrs:{...d,mentionSuggestionChar:a}},{type:"text",text:" "}]).run(),(h=(c=s.view.dom.ownerDocument.defaultView)==null?void 0:c.getSelection())==null||h.collapseToEnd()},allow:({state:s,range:l})=>{const d=s.doc.resolve(l.from),u=s.schema.nodes[i];return!!d.parent.type.contentMatch.matchType(u)},...o}})({editor:n.editor,overrideSuggestionOptions:e,extensionName:n.name,char:e.char})))}function Ct(n,e){const t=Xt(n);return t.find((i=>i.char===e))||(t.length?t[0]:null)}var Co=Ge.create({name:"mention",priority:101,addOptions:()=>({HTMLAttributes:{},renderText({node:n,suggestion:e}){var t,o;return`${(t=e?.char)!=null?t:"@"}${(o=n.attrs.label)!=null?o:n.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:n,node:e,suggestion:t}){var o,i;return["span",Fe(this.HTMLAttributes,n.HTMLAttributes),`${(o=t?.char)!=null?o:"@"}${(i=e.attrs.label)!=null?i:e.attrs.id}`]},suggestions:[],suggestion:{}}),group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes:()=>({id:{default:null,parseHTML:n=>n.getAttribute("data-id"),renderHTML:n=>n.id?{"data-id":n.id}:{}},label:{default:null,parseHTML:n=>n.getAttribute("data-label"),renderHTML:n=>n.label?{"data-label":n.label}:{}},mentionSuggestionChar:{default:"@",parseHTML:n=>n.getAttribute("data-mention-suggestion-char"),renderHTML:n=>({"data-mention-suggestion-char":n.mentionSuggestionChar})}}),parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:n,HTMLAttributes:e}){const t=Ct(this,n.attrs.mentionSuggestionChar);if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",Fe({"data-type":this.name},this.options.HTMLAttributes,e),this.options.renderLabel({options:this.options,node:n,suggestion:t})];const o={...this.options};o.HTMLAttributes=Fe({"data-type":this.name},this.options.HTMLAttributes,e);const i=this.options.renderHTML({options:o,node:n,suggestion:t});return typeof i=="string"?["span",Fe({"data-type":this.name},this.options.HTMLAttributes,e),i]:i},...Cn({nodeName:"mention",name:"@",selfClosing:!0,allowedAttributes:["id","label",{name:"mentionSuggestionChar",skipIfDefault:"@"}],parseAttributes:n=>{const e={},t=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let o=t.exec(n);for(;o!==null;){const[,i,a,r]=o,s=a??r;e[i==="char"?"mentionSuggestionChar":i]=s,o=t.exec(n)}return e},serializeAttributes:n=>Object.entries(n).filter((([,e])=>e!=null)).map((([e,t])=>`${e==="mentionSuggestionChar"?"char":e}="${t}"`)).join(" ")}),renderText({node:n}){const e={options:this.options,node:n,suggestion:Ct(this,n.attrs.mentionSuggestionChar)};return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel(e)):this.options.renderText(e)},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command((({tr:n,state:e})=>{let t=!1;const{selection:o}=e,{empty:i,anchor:a}=o;if(!i)return!1;let r=new Mn,s=0;return e.doc.nodesBetween(a-1,a,((l,d)=>{if(l.type.name===this.name)return t=!0,r=l,s=d,!1})),t&&n.insertText(this.options.deleteTriggerWithBackspace?"":r.attrs.mentionSuggestionChar,s,s+r.nodeSize),t}))}},addProseMirrorPlugins(){return Xt(this).map(xo)}});function Mt(n,e){const t=[];return e.$doc.content.descendants((o=>{o.type.name===n&&t.push(o)})),t}function Et(n,e,t,o={}){const i=[],a=(r,s)=>{o.onNewMention?.(r,s),i.push(r)};return e.descendants(((r,s)=>{if(r.type.name!==n)return;if(t===null)return void a(r,s);const l=Math.abs(e.nodeSize-t.nodeSize),d=t.nodeSize-2,u=l+r.nodeSize+1,c=Math.max(0,s-u),h=Math.min(d,s+u);let m=!1;t.nodesBetween(c,h,(_=>{if(_.type.name===n&&_.attrs.id===r.attrs.id)return m=!0,o.onExistingMention?.(_,s),!1})),m||a(r,s)})),i}function Wt(n,e){const t=new MutationObserver((o=>{for(const i of o)if(e.shouldTrigger(i))return e.callback(),void t.disconnect()}));return t.observe(n,{childList:!0,subtree:!0,...e.mutationObserverInit}),e.timeout&&setTimeout((()=>t.disconnect()),e.timeout),()=>t.disconnect()}function Tt(n,e,t,o){return Wt(n,{shouldTrigger:i=>new Set(i.addedNodes).has(e),callback:t,timeout:o})}class je{constructor(e){this._mentionPluginId=e}static CHIP_CLASS_NAME="c-mention-chip";static CHIP_DATA_ATTR_KEY="data-augment-mention-chip-tooltip";_disposers=[];_editor;_tooltipData=re(void 0);get tooltipData(){return this._tooltipData}onCreate=e=>{this._editor=e};onDispose=()=>{this._editor=void 0,this._disposers.forEach((e=>e())),this._disposers=[]};_attachChipEventListeners(e,t){e.addEventListener("mouseenter",t),e.addEventListener("mouseover",t),e.addEventListener("mouseleave",this.hideTooltip)}_detachChipEventListeners(e,t){e.removeEventListener("mouseenter",t),e.removeEventListener("mouseover",t),e.removeEventListener("mouseleave",this.hideTooltip)}_removeFromDisposers(e){e&&(this._disposers=this._disposers.filter((t=>t!==e)))}_setupMountUnmountCycle(e,t,o){let i,a;const r=()=>{this._removeFromDisposers(i),this._detachChipEventListeners(t,o),a=Tt(e,t,s),this._disposers.push(a)},s=()=>{var l,d;this._removeFromDisposers(a),this._attachChipEventListeners(t,o),l=t,i=Wt(e,{shouldTrigger:u=>new Set(u.removedNodes).has(l),callback:r,timeout:d}),this._disposers.push(i)};Tt(e,t,s)}createMentionChip=({options:e,node:t})=>{if(t.type.name!==this._mentionPluginId)throw new Error("Expected a mention node");const o=document.createElement("span");o.innerText=`${e.suggestion?.char??"@"}${t.attrs.label}`;for(const[a,r]of Object.entries(e.HTMLAttributes))typeof r=="string"?o.setAttribute(a,r.toString()):console.warn(`Unexpected HTML attribute value type: [${a}] = ${r}`);const i=this._editor?.view.dom;return i&&this._setupMountUnmountCycle(i,o,(()=>{this._tooltipData.set({data:t.attrs.data,anchorElement:o})})),o};hideTooltip=()=>{this._tooltipData.set(void 0)}}class Mo{constructor(e={}){this._opts=e}_menuData=re(void 0);_mentionables=re([]);query=Ce(this._menuData,(e=>e?.tiptapExtensionProps.query));activeIdx=Ce([this._mentionables,this._menuData],To);activeItem=Ce([this._mentionables,this.activeIdx],Eo);referenceClientRect=Ce(this._menuData,(e=>e?.referenceClientRect));tiptapExtensionProps=Ce(this._menuData,(e=>e?.tiptapExtensionProps));isMenuActive=Ce(this._menuData,(e=>e!==void 0));mentionables=this._mentionables;updateOptions=e=>{this._opts={...this._opts,...e}};updateMentionables=e=>{this._mentionables.set(e)};replaceQueryWithMentionNode=e=>{const t=W(this.isMenuActive),o=W(this.tiptapExtensionProps)?.command;return!(!t||!o)&&(o(e),!0)};selectItem=e=>!(W(this._mentionables).findIndex((t=>t.id===e.id))===-1||!this._opts.onSelectMentionable)&&(this._opts.onSelectMentionable?.(e),!0);_incrementActiveIdx=()=>{const e=W(this.activeIdx)??0;this._setActiveIdx(e+1)};_decrementActiveIdx=()=>{const e=W(this.activeIdx)??0;this._setActiveIdx(e-1)};_setActiveIdx=e=>{this._menuData.update((t=>t&&{...t,activeIdx:e}))};onUpdateSuggestion=e=>{const t=e.clientRect?.();t&&this._menuData.update((o=>({referenceClientRect:t,tiptapExtensionProps:e,activeIdx:o?.activeIdx??0})))};exitMenu=()=>{this._menuData.set(void 0),this._mentionables.set([])};_handleKeyIfActive=e=>()=>!!W(this.isMenuActive)&&(e(),!0);onArrowUp=this._handleKeyIfActive(this._decrementActiveIdx);onArrowDown=this._handleKeyIfActive(this._incrementActiveIdx);onEscape=this._handleKeyIfActive((()=>{this.exitMenu()}));selectActiveItem=this._handleKeyIfActive((()=>{const e=W(this.activeItem);return!!e&&this.selectItem(e)}))}function Eo([n,e]){if(e!==void 0&&n.length!==0)return n[e]}function To([n,e]){if(!(e?.activeIdx===void 0||n.length===0))return(e.activeIdx%n.length+n.length)%n.length%n.length}class Se{constructor(e){this._options=e;const t=e.triggerCharacter??"@";this._triggerCharacter=t;const o=new de(this._mentionListenerPluginId),i=new de(this._mentionPluginId),a=e.allowedPrefixes??[" ","	",`
`],r=e.renderText??(y=>`${t}${y.name??y.id}`);this._chipController=new je(this._mentionPluginId);const s=this._onCreate.bind(this),l=this._onProseMirrorUpdate.bind(this),d=this._onDestroy.bind(this),u=this._chipController.createMentionChip,c=this._mentionableMenuContext.onUpdateSuggestion,h=this._mentionableMenuContext.exitMenu,m=this._mentionableMenuContext.onArrowUp,_=this._mentionableMenuContext.onArrowDown,M=this._mentionableMenuContext.selectActiveItem;this._mention=Co.extend({name:this._mentionPluginId,onCreate(){s(this.editor)},onDestroy(){d()},addKeyboardShortcuts:()=>({ArrowUp:m,ArrowDown:_,Enter:M,Tab:M}),addAttributes(){return{...this.parent?.()??{},data:{default:null,keepOnSplit:!1,parseHTML:y=>{const f=y.getAttribute(je.CHIP_DATA_ATTR_KEY);return f?JSON.parse(f):null},renderHTML:y=>y.data?{[je.CHIP_DATA_ATTR_KEY]:JSON.stringify(y.data)}:{}}}},addProseMirrorPlugins(){return[...this.parent?.()??[],new me({key:o,view:()=>({update:(y,f)=>{l(f.doc,y.state.doc)}})})]},addOptions(){const y=this.parent,f=y?.();return{...f,HTMLAttributes:{class:je.CHIP_CLASS_NAME},deleteTriggerWithBackspace:f?.deleteTriggerWithBackspace??!1,suggestions:f?.suggestions??[],renderHTML:u,renderText:({node:p})=>{const w=p.attrs,x=w.data;if(!x){const B={id:w.id||"unknown",label:w.label||"Unknown mention",name:w.label||w.id||"unknown"};return console.warn("Mention data missing, using fallback:",B),r(B)}return r(x)},suggestion:{...f?.suggestion,pluginKey:i,char:t,allowedPrefixes:a,command:({editor:p,range:w,props:x})=>{const B=x;if(p&&w){p.view.state.selection.$to.nodeAfter?.text?.startsWith(" ")&&(w.to+=1);const S=En(B,t);p.chain().focus().insertContentAt(w,[S,{type:"text",text:" "}]).run(),p.view.dom.ownerDocument.defaultView?.getSelection()?.collapseToEnd()}},render:()=>({onStart:c,onUpdate:c,onExit:h})}}}})}static CONTEXT_KEY="augment-svelte-mention-plugin";static MENTION_LISTENER_PLUGIN_ID_BASE="{}-listener";static MENTION_PLUGIN_ID_BASE="augment-prosemirror-mention-{}";static DEFAULT_MENTION_PLUGIN_ID="mention";_triggerCharacter;_editor;_mention;_chipController;_mentionableMenuContext=new Mo;get chipController(){return this._chipController}get mentionableMenuContext(){return this._mentionableMenuContext}insertMentionNode=e=>!!this._editor&&(this._mentionableMenuContext.replaceQueryWithMentionNode(e.data)||this._editor.commands.insertContent({type:this._mentionPluginId,attrs:e}),!0);get _mentionPluginId(){return this._options.pluginId?this._options.pluginId:this._triggerCharacter==="@"?Se.DEFAULT_MENTION_PLUGIN_ID:Se.MENTION_PLUGIN_ID_BASE.replace("{}",this._triggerCharacter)}get _mentionListenerPluginId(){return Se.MENTION_LISTENER_PLUGIN_ID_BASE.replace("{}",this._mentionPluginId)}_onCreate=e=>{const t=Mt(this._mentionPluginId,e).map((o=>o.attrs.data));this._options.onMentionItemsUpdated?.({added:t,removed:[],current:t}),this._editor=e,this._chipController.onCreate(e)};_onDestroy=()=>{if(this._editor){const e=Mt(this._mentionPluginId,this._editor).map((t=>t.attrs.data));this._options.onMentionItemsUpdated?.({added:[],removed:e,current:[]}),this._editor=void 0,this._chipController.onDispose()}this._chipController.hideTooltip(),this._mentionableMenuContext.exitMenu()};_onProseMirrorUpdate=(e,t)=>{if(Kn(e,t))return;const o=s=>s.attrs.data,i=[],a=Et(this._mentionPluginId,e,t).map(o),r=Et(this._mentionPluginId,t,e,{onNewMention:s=>i.push(o(s)),onExistingMention:s=>i.push(o(s))}).map(o);r.length===0&&a.length===0||this._options.onMentionItemsUpdated?.({added:r,removed:a,current:i})};get tipTapExtension(){return this._mention}}var Io=U("<!> <!>",1);const So=function(n,e){ge(e,!0);const t=()=>pe(a,"$chipTooltipData",o),[o,i]=Be(),a=Ae(Se.CONTEXT_KEY).chipController.tooltipData;let r=dt(void 0);Ie((()=>{t()===void 0?H(r)?.requestClose():H(r)?.requestOpen()}));{const s=d=>{var u=k(),c=b(u),h=m=>{var _=k(),M=b(_);we(M,(()=>e.children),(()=>t().data)),g(m,_)};L(c,(m=>{t()&&e.children&&m(h)})),g(d,u)};let l=se((()=>t()?.anchorElement.getBoundingClientRect()));ct(mn(n,{triggerOn:[],get referenceClientRect(){return H(l)},content:s,$$slots:{content:!0}}),(d=>ut(r,d,!0)),(()=>H(r)))}fe(),i()},Ao=function(n,e){ge(e,!0);let t=Y(e,"onMentionItemsUpdated",19,(()=>{})),o=Y(e,"triggerCharacter",19,(()=>{})),i=Y(e,"allowedPrefixes",19,(()=>{})),a=Y(e,"pluginId",19,(()=>{})),r=Y(e,"renderText",19,(()=>{}));const s=new Se({onMentionItemsUpdated:h=>t()?.(h),triggerCharacter:o(),allowedPrefixes:i(),pluginId:a(),renderText:r()});St(Se.CONTEXT_KEY,s);const l=Ae(le.CONTEXT_KEY).pluginManager.registerPlugin(s);ht(l);var d={insertMention:h=>{s.insertMentionNode({id:h.id,label:h.label,data:h})}},u=k(),c=b(u);return we(c,(()=>e.children??At)),g(n,u),fe(d)},Po={Root:function(n,e){ge(e,!0);const t=()=>pe(c,"$query",o),[o,i]=Be(),a=Ae(Se.CONTEXT_KEY);let r=Y(e,"onSelectMentionable",3,(x=>(a.insertMentionNode({...x,data:x}),!0))),s=dt(void 0);const l=Ae(le.CONTEXT_KEY),d=a.mentionableMenuContext,{referenceClientRect:u,query:c,activeItem:h,isMenuActive:m,exitMenu:_}=d;Ie((()=>{e.onQueryUpdate(t())})),Ie((()=>{d.updateOptions({onSelectMentionable:r()})})),Ie((()=>{d.updateMentionables(e.mentionables)}));const M=async x=>{x||l.commandManager.requestFocus()};var y={requestOpen:()=>H(s)?.requestOpen(),requestClose:()=>H(s)?.requestClose(),focusIdx:x=>H(s)?.focusIdx(x)},f=k(),p=b(f);Ne(p,(()=>He.Root),((x,B)=>{ct(B(x,{get open(){return pe(m,"$isMenuActive",o)},onOpenChange:M,nested:!1,children:(C,$)=>{var S=Io(),F=b(S);Ne(F,(()=>He.Trigger),((N,T)=>{T(N,{get referenceClientRect(){return pe(u,"$referenceClientRect",o)}})}));var E=Q(F,2);Ne(E,(()=>He.Content),((N,T)=>{T(N,{side:"top",align:"start",size:1,get onClickOutside(){return _},get onEscapeKeyDown(){return _},children:(A,I)=>{var v=k(),O=b(v),q=D=>{var X=k(),K=b(X);we(K,(()=>e.children),(()=>({activeItem:pe(h,"$activeItem",o),query:t()}))),g(D,X)};L(O,(D=>{e.children&&D(q)})),g(A,v)},$$slots:{default:!0}})})),g(C,S)},$$slots:{default:!0}}),(C=>ut(s,C,!0)),(()=>H(s)))})),g(n,f);var w=fe(y);return i(),w}};class tt{constructor(e,t){this._reduxStore=e,this._insertMentionNode=t;const o=this._reduxStore,i=Tn.withStore(o)(this._breadcrumbIds),a=In.withStore(o)();this._displayItems=Ce([this._active,this._breadcrumbIds,this._userQuery,i,a],(([r,s,l,d,u])=>{if(!r)return[];if(s.length>0&&d)return[{...d,type:"breadcrumb-back"},...d.group.items.slice(0,tt.SINGLE_GROUP_MAX_ITEMS).map((c=>({...c,type:"item"})))];if(l.length>0){const c=ko(l).map((h=>({...h,type:"item"})));return u.flatMap((h=>[{...h,type:"breadcrumb"},...h.group.items.slice(0,tt.MULTI_GROUP_MAX_ITEMS).map((m=>({...m,type:"item"})))])).concat(c)}return[{...Ot,type:"item"},...u.map((c=>({...c,type:"breadcrumb"}))),{...Dt,type:"item"}]}))}static REFRESH_THROTTLE_MS=600;static SINGLE_GROUP_MAX_ITEMS=12;static MULTI_GROUP_MAX_ITEMS=6;_breadcrumbIds=re([]);_userQuery=re("");_active=re(!1);get breadcrumbIds(){return this._breadcrumbIds}get displayItems(){return this._displayItems}get active(){return this._active}get userQuery(){return this._userQuery}openDropdown=()=>{this._reduxStore.dispatch(Sn()),this._active.set(!0)};closeDropdown=()=>{this._active.set(!1),this._resetState()};toggleDropdown=()=>W(this._active)?(this.closeDropdown(),!1):(this.openDropdown(),!0);pushBreadcrumb=e=>{W(this._active)&&this._breadcrumbIds.update((t=>[...t,e.id]))};popBreadcrumb=()=>{W(this._active)&&this._breadcrumbIds.update((e=>e.slice(0,-1)))};selectMentionable=e=>{if(Je(e)&&e.type==="breadcrumb")return this.pushBreadcrumb(e),!0;if(e.type==="breadcrumb-back")return this.popBreadcrumb(),!0;if(Lt(e)){const t=vt.select(this._reduxStore.getState());return t&&this._reduxStore.dispatch(An(t)),this.closeDropdown(),!0}if(e.clearContext){const t=vt.select(this._reduxStore.getState());return t&&this._reduxStore.dispatch(Pn(t)),this.closeDropdown(),!0}return this._insertMentionNode?.(e),this.closeDropdown(),!0};_displayItems;_resetState(){this._breadcrumbIds.set([]),this._userQuery.set("")}}const ko=n=>kn({query:n,mentionables:[Ot,Dt],returnAllIfNoResults:!1,threshold:.6});function jt(n){switch(n){case Xe.DEFAULT:return"agent-auggie";case Xe.PROTOTYPER:return"prototyper-auggie";case Xe.BRAINSTORM:return"brainstorm-auggie";case Xe.REVIEWER:return"reviewer-auggie";default:return"agent-auggie"}}var $o=U('<span class="c-context-menu-item__icon svelte-bg3ox5"><!></span>'),No=U('<span class="c-mentionable-group-label"><span class="c-mentionable-group-label__text right"> </span></span>');function Oo(n,e){ge(e,!0);let t=Y(e,"highlight",19,(()=>{}));const o=se((()=>e.item.type==="breadcrumb-back"?He.BreadcrumbBackItem:e.item.type==="breadcrumb"&&Je(e.item)?He.BreadcrumbItem:e.item.type!=="item"||Je(e.item)?void 0:He.Item));var i=k(),a=b(i),r=s=>{const l=se((()=>H(o)));var d=k(),u=b(d);Ne(u,(()=>H(l)),((c,h)=>{h(c,{get highlight(){return t()},get onSelect(){return e.onSelect},children:(m,_)=>{var M=k(),y=b(M),f=w=>{ae(w,{get filepath(){return e.item.file.pathName},leftIcon:B=>{Z(B,{name:"file-text"})},$$slots:{leftIcon:!0}})},p=w=>{var x=k(),B=b(x),C=S=>{ae(S,{get filepath(){return e.item.folder.pathName},leftIcon:E=>{Z(E,{name:"folder-open"})},$$slots:{leftIcon:!0}})},$=S=>{var F=k(),E=b(F),N=A=>{ae(A,{get filepath(){return e.item.externalSource.name},leftIcon:v=>{Z(v,{name:"book-open"})},$$slots:{leftIcon:!0}})},T=A=>{var I=k(),v=b(I),O=D=>{ae(D,{get filepath(){return e.item.sourceFolder.folderRoot},leftIcon:K=>{Z(K,{name:"folder-root"})},$$slots:{leftIcon:!0}})},q=D=>{var X=k(),K=b(X),R=z=>{ae(z,{get filepath(){return e.item.selection.pathName},leftIcon:te=>{Z(te,{name:"text-cursor"})},$$slots:{leftIcon:!0}})},P=z=>{var ee=k(),te=b(ee),oe=j=>{ae(j,{get filepath(){return e.item.recentFile.pathName},leftIcon:ne=>{Z(ne,{name:"file-text"})},$$slots:{leftIcon:!0}})},be=j=>{var Pe=k(),ne=b(Pe),ve=ce=>{ae(ce,{get filepath(){return e.item.rule.path},leftIcon:nt=>{Z(nt,{name:"list-todo"})},$$slots:{leftIcon:!0}})},Ee=ce=>{var ke=k(),nt=b(ke),Jt=Oe=>{var Ue=ye();ie((()=>ue(Ue,e.item.label))),g(Oe,Ue)},Qt=Oe=>{var Ue=k(),Zt=b(Ue),en=De=>{Gn(De,{leftIcon:Ke=>{var xe=$o(),Ve=V(xe);{let it=se((()=>jt(e.item.personality.type)));Z(Ve,{get name(){return H(it)},size:1})}g(Ke,xe)},text:Ke=>{var xe=ye();ie((()=>ue(xe,e.item.label))),g(Ke,xe)},$$slots:{leftIcon:!0,text:!0}})},tn=De=>{var ot=k(),mt=b(ot),Ke=xe=>{var Ve=No(),it=V(Ve),nn=V(it);ie((()=>ue(nn,e.item.label))),g(xe,Ve)};L(mt,(xe=>{(Lt(e.item)||Nn(e.item))&&xe(Ke)}),!0),g(De,ot)};L(Zt,(De=>{Ut(e.item)?De(en):De(tn,!1)}),!0),g(Oe,Ue)};L(nt,(Oe=>{Je(e.item)?Oe(Jt):Oe(Qt,!1)}),!0),g(ce,ke)};L(ne,(ce=>{zt(e.item)?ce(ve):ce(Ee,!1)}),!0),g(j,Pe)};L(te,(j=>{$n(e.item)?j(oe):j(be,!1)}),!0),g(z,ee)};L(K,(z=>{Bt(e.item)?z(R):z(P,!1)}),!0),g(D,X)};L(v,(D=>{Ht(e.item)?D(O):D(q,!1)}),!0),g(A,I)};L(E,(A=>{qt(e.item)?A(N):A(T,!1)}),!0),g(S,F)};L(B,(S=>{Ft(e.item)?S(C):S($,!1)}),!0),g(w,x)};L(y,(w=>{Rt(e.item)?w(f):w(p,!1)})),g(m,M)},$$slots:{default:!0}})})),g(s,d)};L(a,(s=>{H(o)&&s(r)})),g(n,i),fe()}var Do=U('<button type="button"><!> <!></button>');function Lo(n,e){ge(e,!0);const t=()=>pe(H(r),"$isSourceFolderOverLimit",o),[o,i]=Be(),a=On(),r=se((()=>Ln(e.sourceFolder.folderRoot))),s=se((()=>Dn(e.sourceFolder.folderRoot)));let l=se((()=>t()?`Workspace guidelines exceeded ${pe(H(s),"$sourceFolderLimit",o)} character limit`:"Edit workspace guidelines"));var d=Do();d.__click=()=>{a.openGuidelines(e.sourceFolder.folderRoot)};var u=V(d);{let h=se((()=>t()?"circle-alert":"square-pen"));Z(u,{get name(){return H(h)}})}var c=Q(u,2);Re(c,{class:"c-guidelines-filespan__text",size:1,truncate:!0,children:(h,m)=>{var _=ye();ie((()=>ue(_,H(l)))),g(h,_)},$$slots:{default:!0}}),ie((()=>lt(d,1,an(["c-guidelines-filespan",e.class]),"svelte-gu2i0f"))),g(n,d),fe(),i()}It(["click"]);var Ro=ln('<svg width="102" height="9" viewBox="0 0 102 9" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="51" cy="4.5" rx="51" ry="4.5" fill="currentColor"></ellipse></svg>'),Fo=U('<div class="c-augment-logo-animated__shadow svelte-ft7f11"><!></div>'),qo=U('<div><div class="c-augment-logo-animated__icon svelte-ft7f11"><!></div> <!></div>');function Ho(n,e){let t=Y(e,"sizePx",3,160),o=Y(e,"floatHeight",3,20),i=Y(e,"animationDuration",3,3),a=Y(e,"showShadow",3,!0),r=Y(e,"animated",3,!0),s=se((()=>Math.round(.875*t())));var l=qo();let d,u;var c=V(l),h=V(c),m=f=>{var p=k(),w=b(p);we(w,(()=>e.children)),g(f,p)},_=f=>{Z(f,{name:"augment-logo"})};L(h,(f=>{e.children?f(m):f(_,!1)}));var M=Q(c,2),y=f=>{var p=Fo();(function(w){var x=Ro();g(w,x)})(V(p)),g(f,p)};L(M,(f=>{a()&&f(y)})),ie((()=>{d=lt(l,1,"c-augment-logo-animated svelte-ft7f11",null,d,{"c-augment-logo-animated--animated":r()}),u=dn(l,"",u,{"--augment-logo-size":`${t()??""}px`,"--augment-logo-icon-size":`${H(s)??""}px`,"--augment-logo-float-height":`${o()??""}px`,"--animation-duration":`${i()??""}s`})})),g(n,l)}var Bo=U("<!> <!>",1),zo=U("<!> <!>",1),Uo=U("<!> <!>",1),Ko=U('<div class="l-mention-hover-contents__source-folder svelte-1x76h3w"><div class="l-source-folder-name svelte-1x76h3w"><!> <!></div> <!></div>'),Go=U("<!> <!>",1),Yo=U('<div class="c-mention-hover-contents__personality-icon svelte-1x76h3w"><!></div> <div class="c-mention-hover-contents__personality svelte-1x76h3w"><!> <!></div>',1),Vo=U('<div class="c-mention-hover-contents__task svelte-1x76h3w"><!> <!></div>'),Xo=U("<!> <!>",1),Wo=U('<div class="c-mention-hover-contents svelte-1x76h3w"><!></div>');function jo(n,e){ge(e,!0);var t=Wo(),o=V(t),i=r=>{var s=Bo(),l=b(s);Z(l,{name:"file"});var d=Q(l,2);ae(d,{get filepath(){return e.option.file.pathName}}),g(r,s)},a=r=>{var s=k(),l=b(s),d=c=>{var h=zo(),m=b(h);Z(m,{name:"folder-open"});var _=Q(m,2);ae(_,{get filepath(){return e.option.folder.pathName}}),g(c,h)},u=c=>{var h=k(),m=b(h),_=y=>{var f=Uo(),p=b(f);Z(p,{name:"book"});var w=Q(p,2);ae(w,{get filepath(){return e.option.externalSource.name}}),g(y,f)},M=y=>{var f=k(),p=b(f),w=B=>{var C=Ko(),$=V(C),S=V($);Z(S,{name:"folder-tree"});var F=Q(S,2);ae(F,{class:"c-source-folder-item",get filepath(){return e.option.sourceFolder.folderRoot}}),Lo(Q($,2),{class:"guidelines-filespan",get sourceFolder(){return e.option.sourceFolder}}),g(B,C)},x=B=>{var C=k(),$=b(C),S=E=>{var N=k(),T=b(N),A=I=>{var v=k(),O=b(v),q=D=>{Re(D,{size:1,children:(X,K)=>{var R=ye();ie((()=>ue(R,`Guidelines exceeded length limit of ${e.option.userGuidelines.lengthLimit} characters`))),g(X,R)},$$slots:{default:!0}})};L(O,(D=>{e.option.userGuidelines.overLimit&&D(q)})),g(I,v)};L(T,(I=>{e.option.userGuidelines.overLimit&&I(A)})),g(E,N)},F=E=>{var N=k(),T=b(N),A=v=>{var O=Go(),q=b(O);Z(q,{name:"text-cursor"});var D=Q(q,2);{let X=se((()=>`${e.option.selection.pathName}:L${e.option.selection.fullRange?.startLineNumber}-${e.option.selection.fullRange?.endLineNumber}`));ae(D,{get filepath(){return H(X)}})}g(v,O)},I=v=>{var O=k(),q=b(O),D=K=>{var R=Yo(),P=b(R);Ho(V(P),{sizePx:32,floatHeight:4,animationDuration:2.25,children:(oe,be)=>{{let j=se((()=>jt(e.option.personality.type)));Z(oe,{get name(){return H(j)}})}},$$slots:{default:!0}});var z=Q(P,2),ee=V(z);Re(ee,{size:2,weight:"medium",children:(oe,be)=>{var j=ye();ie((()=>ue(j,e.option.label))),g(oe,j)},$$slots:{default:!0}});var te=Q(ee,2);Re(te,{size:1,children:(oe,be)=>{var j=ye();ie((()=>ue(j,e.option.personality.description))),g(oe,j)},$$slots:{default:!0}}),g(K,R)},X=K=>{var R=k(),P=b(R),z=te=>{var oe=Vo(),be=V(oe);Re(be,{size:2,weight:"bold",children:(ne,ve)=>{var Ee=ye();ie((()=>ue(Ee,e.option.task.taskTree.name))),g(ne,Ee)},$$slots:{default:!0}});var j=Q(be,2),Pe=ne=>{Re(ne,{size:1,children:(ve,Ee)=>{var ce=ye();ie((ke=>ue(ce,ke)),[()=>e.option.task.taskTree.description.trim().replace(/\s+/g," ")]),g(ve,ce)},$$slots:{default:!0}})};L(j,(ne=>{e.option.task.taskTree.description&&e.option.task.taskTree.description.trim()&&ne(Pe)})),g(te,oe)},ee=te=>{var oe=k(),be=b(oe),j=ne=>{var ve=Xo(),Ee=b(ve);Z(Ee,{name:"ruler"});var ce=Q(Ee,2);{let ke=se((()=>`${qn}/${Hn}/${e.option.rule.path}`));ae(ce,{get filepath(){return H(ke)}})}g(ne,ve)},Pe=ne=>{var ve=ye();ie((()=>ue(ve,e.option.label))),g(ne,ve)};L(be,(ne=>{e.option&&zt(e.option)?ne(j):ne(Pe,!1)}),!0),g(te,oe)};L(P,(te=>{e.option&&Fn(e.option)?te(z):te(ee,!1)}),!0),g(K,R)};L(q,(K=>{e.option&&Ut(e.option)?K(D):K(X,!1)}),!0),g(v,O)};L(T,(v=>{e.option&&Bt(e.option)?v(A):v(I,!1)}),!0),g(E,N)};L($,(E=>{e.option&&Rn(e.option)?E(S):E(F,!1)}),!0),g(B,C)};L(p,(B=>{e.option&&Ht(e.option)?B(w):B(x,!1)}),!0),g(y,f)};L(m,(y=>{e.option&&qt(e.option)?y(_):y(M,!1)}),!0),g(c,h)};L(l,(c=>{e.option&&Ft(e.option)?c(d):c(u,!1)}),!0),g(r,s)};L(o,(r=>{e.option&&Rt(e.option)?r(i):r(a,!1)})),g(n,t),fe()}var Jo=U("<!> <!>",1);function fi(n,e){ge(e,!0);const t=()=>pe(l,"$displayItems",o),[o,i]=Be();let a=Y(e,"onMentionItemsUpdated",19,(()=>{}));const{store:r}=Bn(),s=new tt(r,u),l=s.displayItems;let d=dt(void 0);function u(p){return!!H(d)&&(H(d).insertMention(p),s.closeDropdown(),!0)}const c=zn();function h(p){p===void 0?s.closeDropdown():(s.openDropdown(),s.userQuery.set(p),c(Un(p)))}function m(p){const w=s.selectMentionable(p);return e.requestEditorFocus(),w}var _={insertMentionNode:p=>u(p),getDisplayItems:()=>t()},M=k(),y=b(M);Ne(y,(()=>Ao),((p,w)=>{ct(w(p,{triggerCharacter:"@",get onMentionItemsUpdated(){return a()},children:(x,B)=>{var C=Jo(),$=b(C);{const F=(E,N)=>{var T=k(),A=b(T);cn(A,1,t,(I=>I.id),((I,v)=>{{let O=se((()=>H(v)===N?.().activeItem));Oo(I,{get item(){return H(v)},get highlight(){return H(O)},onSelect:()=>m(H(v))})}})),g(E,T)};Ne($,(()=>Po.Root),((E,N)=>{N(E,{get mentionables(){return t()},onQueryUpdate:h,onSelectMentionable:m,children:F,$$slots:{default:!0}})}))}var S=Q($,2);{const F=(E,N=At)=>{jo(E,{get option(){return N()}})};Ne(S,(()=>So),((E,N)=>{N(E,{children:F,$$slots:{default:!0}})}))}g(x,C)},$$slots:{default:!0}}),(x=>ut(d,x,!0)),(()=>H(d)))})),g(n,M);var f=fe(_);return i(),f}class Qo{_placeholderExtension;_editor;constructor(e){const t=this._onUpdate.bind(this),o=this._onDestroy.bind(this);this._placeholderExtension=ao.extend({onUpdate(){t(this.editor)},onDestroy(){o()}}).configure({placeholder:e})}setPlaceholder=e=>{this._placeholderExtension.options.placeholder=e,this._editor?.view.updateState(this._editor.view.state)};_onUpdate=e=>{this._editor=e};_onDestroy=()=>{this._editor=void 0};get tipTapExtension(){return this._placeholderExtension}}function vi(n,e){ge(e,!0);let t=Y(e,"placeholder",3,"Type something...");const o=new Qo(t()),i=Ae(le.CONTEXT_KEY);ht(i.pluginManager.registerPlugin(o)),Ie((()=>{o.setPlaceholder(t())})),fe()}class qe{constructor(e){this._options=e,this.updateOptions(this._options);const t=this._handleKeyDown,o=qe._getNextPluginId(),i=new de(o);this._tipTapExtension=Me.create({name:o,addProseMirrorPlugins:()=>[new me({key:i,props:{handleKeyDown:t}})]})}static _sequenceId=0;static KEYBINDINGS_PLUGIN_KEY_BASE="augment-keybindings-plugin-{}";static _getSequenceId=()=>qe._sequenceId++;static _getNextPluginId=()=>{const e=qe._getSequenceId().toString();return qe.KEYBINDINGS_PLUGIN_KEY_BASE.replace("{}",e)};_tipTapExtension;_keydownHandler=()=>!1;updateOptions=e=>{this._options={...this._options,...e},this._keydownHandler=Pt(this._options.shortcuts)};get tipTapExtension(){return this._tipTapExtension}_handleKeyDown=(e,t)=>this._keydownHandler(e,t)}function _i(n,e){ge(e,!0);let t=Y(e,"shortcuts",19,(()=>({})));const o=Ae(le.CONTEXT_KEY),i=new qe({shortcuts:t()}),a=o.pluginManager.registerPlugin(i);ht(a),Ie((()=>{i.updateOptions({shortcuts:t()})})),fe()}export{fi as A,jo as C,_i as K,vi as P,gi as R,pi as a,tt as b,Oo as c,mi as d,le as e,Ho as f,hi as g,xt as n};
//# sourceMappingURL=Keybindings-SM11jtx_.js.map
