import{a9 as Ye,ai as Xe,aD as Re,w as ie,aI as $e,W as D,ad as H,aJ as Ie,y as Ee,D as ce,E as oe,K as C,a3 as qe,aH as ze,a1 as le,a2 as Ve,o as n,P as O,R as f,a4 as Ce,a8 as et,H as he,az as Ue,T as x,Q as y,O as Z,J as S,aA as Be,$ as R,av as me,I as be,a0 as w,G as $,_ as _e,S as xe,ae as Se,a6 as He,k as ke,Z as Ae,Y as tt,aK as it,aw as Me,ay as st,ac as ot,ax as nt}from"./debounce-BNOmQ76Y.js";import"./design-system-init-DYAh9Pko.js";import"./legacy-2-VBD5Kq.js";import{M as rt}from"./index-Ba8SPQX6.js";import{n as dt,p as at,b as Le,u as ut,q as ct,t as lt,v as ht,w as ft,S as gt,F as mt}from"./extension-client-context-CN64fWtK.js";import{d as _t}from"./index-C6s5m6Q5.js";import{r as pt,a as Pe}from"./monaco-render-utils-DNMfLSwU.js";import{a as Ze,I as vt}from"./IconButtonAugment-DO0xxfgT.js";import{B as Y}from"./ButtonAugment-BCcs6kST.js";import{I as Ke,S as Te}from"./Icon-CohttyM7.js";import{T as Ct,a as kt}from"./TextTooltipAugment-CGvqFHAr.js";import{K as bt,A as yt,R as We,P as wt}from"./Keybindings-SM11jtx_.js";import{M as It,g as Mt,C as Et}from"./SimpleMonaco-BBDXOnfl.js";import"./file-type-utils-CHwkiE7w.js";import"./message-broker-DUQuEFlt.js";import"./_commonjsHelpers-CwkBNZ52.js";import"./types-M1pd3FSp.js";import"./await-B0-dHWqK.js";import"./lifecycle-CWu4CNTE.js";import"./Chevron-DgXCK6y3.js";import"./input-rvYD24wa.js";import"./BaseTextInput-D02l0mHz.js";import"./CalloutAugment-BTDUhyqD.js";import"./Filespan-FcScXFRk.js";import"./LanguageIcon-BFxv44vU.js";import"./TextCombo-CIszZzGN.js";try{ae=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},(De=new ae.Error().stack)&&(ae._sentryDebugIds=ae._sentryDebugIds||{},ae._sentryDebugIds[De]="088fe37e-6593-4b9e-a68d-cc1520567f40",ae._sentryDebugIdIdentifier="sentry-dbid-088fe37e-6593-4b9e-a68d-cc1520567f40")}catch{}var ae,De;function Ge(a){return(function(e){return"unitOfCodeWork"in e&&!(function(t){return t.children.length>0&&"childIds"in t})(e)})(a)?[a]:a.children.flatMap(Ge)}var ue=(a=>(a.edit="edit",a.instruction="instruction",a))(ue||{}),Ne=(a=>(a[a.instructionDrawer=0]="instructionDrawer",a[a.chunkActionPanel=1]="chunkActionPanel",a))(Ne||{});class xt{_items=[];_focusedItemIdx;_subscribers=new Set;constructor(e=[]){this._items=e}subscribe=e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)});get items(){return this._items}get focusedItem(){if(this._focusedItemIdx!==void 0)return this._items[this._focusedItemIdx]}get focusedItemIdx(){return this._focusedItemIdx}setItems=e=>{this._items=e,this._items.length===0?this.setFocusIdx(void 0):this._focusedItemIdx!==void 0&&this._focusedItemIdx>=this._items.length?this.setFocusIdx(this._items.length-1):this._focusedItemIdx===void 0?this.setFocusIdx(void 0):this.setFocusIdx(this._focusedItemIdx)};setFocus=e=>{if(e!==void 0&&e===this.focusedItem)return;const t=e?this._items.indexOf(e):-1;t===-1?this.setFocusIdx(void 0):this.setFocusIdx(t)};setFocusIdx=e=>{if(e===this._focusedItemIdx||this._items.length===0)return;if(e===void 0)return this._focusedItemIdx=void 0,void this.notifySubscribers();const t=Math.floor(e/this._items.length)*this._items.length;this._focusedItemIdx=(e-t)%this._items.length,this.notifySubscribers()};initFocusIdx=e=>this._focusedItemIdx===void 0&&(this.setFocusIdx(e),!0);focusNext=()=>{const e=this.nextIdx();if(e!==void 0)return this.setFocus(this._items[e]),e};focusPrev=()=>{const e=this.prevIdx();if(e!==void 0)return this.setFocus(this._items[e]),e};prevIdx=(e={})=>{if(this._items.length!==0)return this._focusedItemIdx===void 0?this._items.length-1:e.nowrap&&this._focusedItemIdx===0?0:(this._focusedItemIdx-1+this._items.length)%this._items.length};nextIdx=(e={})=>{if(this._items.length!==0)return this._focusedItemIdx===void 0?0:e.nowrap&&this._focusedItemIdx===this._items.length-1?this._items.length-1:(this._focusedItemIdx+1)%this._items.length};notifySubscribers=()=>{this._subscribers.forEach((e=>e(this)))}}class St{constructor(e,t,i){this.id=e,this.originalCode=t,this._monaco=i,this._originalModel=this._monaco.editor.createModel(t),this._modifiedModel=this._monaco.editor.createModel(t)}_originalModel;_modifiedModel;_fullEdits=[];_currEdit;_currOriginalEdit;swapBaseModel=e=>{this._originalModel.setValue(e),this._modifiedModel.setValue(e),this._fullEdits.forEach((t=>{this._modifiedModel.applyEdits([t])})),this._currEdit&&this._modifiedModel.applyEdits([this._currEdit]),this._currOriginalEdit&&this._originalModel.applyEdits([this._currOriginalEdit])};finish=()=>this._completeCurrEdit();onReceiveChunk=e=>e.data.newChunkStart?this._startNewEdit(e.data.newChunkStart):e.data.chunkContinue&&this._currEdit?this._continueEdit(e.data.chunkContinue):e.data.chunkEnd&&this._currEdit?this._completeCurrEdit(e.data.chunkEnd):void 0;get hasReceivedFirstChunk(){return this._currEdit!==void 0||this._fullEdits.length>0}get originalValue(){return this._originalModel.getValue()}get modifiedValue(){return this._modifiedModel.getValue()}get currEdit(){return this._currEdit}_completeCurrEdit=e=>{const t={resetOriginal:[],original:[],modified:[]};if(!e)return t;if(this._currEdit){this._currEdit.range=new this._monaco.Range(e.stagedStartLine,0,e.stagedEndLine,0);const i=this._nextModifiedInsertPosition(),s=e.stagedEndLine-e.stagedStartLine,o={range:new this._monaco.Range(i.lineNumber,0,i.lineNumber+s,0),text:""};t.modified.push(o),this._modifiedModel.applyEdits([o]),this._fullEdits.push(this._currEdit),this._currEdit=void 0}return t};_startNewEdit=e=>{const t={resetOriginal:[],original:[],modified:[]};return this._currOriginalEdit=void 0,this._currEdit={range:new this._monaco.Range(e.stagedStartLine,0,e.stagedStartLine,0),text:""},t.modified.push(this._currEdit),this._modifiedModel.applyEdits([this._currEdit]),t};_continueEdit=e=>{if(!this._currEdit)throw new Error("No current edit");const t=this._nextModifiedInsertPosition(),i={...this._currEdit,text:e.newText,range:new this._monaco.Range(t.lineNumber,t.column,t.lineNumber,t.column)};return this._modifiedModel.applyEdits([i]),this._currEdit.text+=e.newText,{resetOriginal:[],original:[],modified:e.newText.length>0?[i]:[]}};_nextModifiedInsertPosition=()=>{if(!this._currEdit)throw new Error("No current edit");const e=this._modifiedModel.getOffsetAt({lineNumber:this._currEdit.range.startLineNumber,column:this._currEdit.range.startColumn})+(this._currEdit.text?.length??0);return this._modifiedModel.getPositionAt(e)}}class Lt{constructor(e,t,i,s){this._editorContainer=e,this._reduxStore=t,this._monaco=s,this._asyncMsgSender=new Ye((o=>Xe.postMessage(o))),this.initializeEditor(i)}_asyncMsgSender;_editor;_focusModel=new xt;_hasScrolledOnInit=!1;_markHasScrolledOnInit=Re((()=>{this._hasScrolledOnInit=!0}),200);_resetScrollOnInit=()=>{this._markHasScrolledOnInit.cancel(),this._hasScrolledOnInit=!1};_subscribers=new Set;_disposables=[];_rootChunk;_keybindings=ie({});_requestId=ie(void 0);requestId=this._requestId;_disableResolution=ie(!1);disableResolution=$e(this._disableResolution);_disableApply=ie(!1);disableApply=$e(this._disableApply);_currStream;_isLoadingDiffChunks=ie(!1);_selectionLines=ie(void 0);_mode=ie(ue.edit);initializeEditor=e=>{this._editor=this._monaco.editor.createDiffEditor(this._editorContainer,{automaticLayout:!0,theme:e,readOnly:!0,contextmenu:!1,renderSideBySide:!1,renderIndicators:!0,renderMarginRevertIcon:!1,originalEditable:!1,diffCodeLens:!1,renderOverviewRuler:!1,ignoreTrimWhitespace:!1,scrollBeyondLastLine:!0,maxComputationTime:0,minimap:{enabled:!1},padding:{top:16}}),this._editor.getOriginalEditor().updateOptions({lineNumbers:"off"}),this._monaco.editor.registerCommand?.("acceptFocusedChunk",this.acceptFocusedChunk),this._monaco.editor.registerCommand?.("rejectFocusedChunk",this.rejectFocusedChunk),this._monaco.editor.registerCommand?.("acceptAllChunks",this.acceptAllChunks),this._monaco.editor.registerCommand?.("rejectAllChunks",this.rejectAllChunks),this._monaco.editor.registerCommand?.("focusNextChunk",this.focusNextChunk),this._monaco.editor.registerCommand?.("focusPrevChunk",this.focusPrevChunk),this._disposables.push(this._editor,this._editor.onDidUpdateDiff(this.onDidUpdateDiff),this._editor.getModifiedEditor().onMouseMove(this.onMouseMoveModified),{dispose:this._focusModel.subscribe((t=>this.notifySubscribers()))}),this.initialize()};subscribe=e=>(this._subscribers.add(e),e(this),()=>{this._subscribers.delete(e)});dispose=()=>{this._editor.dispose(),this._subscribers.clear(),this._disposables.forEach((e=>e.dispose()))};notifySubscribers=()=>{this._subscribers.forEach((e=>e(this)))};onDidUpdateDiff=()=>{if(this.updateCodeChunk(),!this._hasScrolledOnInit&&this.leaves?.length){this._markHasScrolledOnInit();const e=this.leaves[0];this.revealChunk(e)}this.notifyDiffViewUpdated(),this.notifySubscribers()};onMouseMoveModified=e=>{if(e.target.position?.lineNumber===void 0||this.leaves===void 0)return;const t=this.editorOffset,i=e.target.position?.lineNumber;for(let s=0;s<this.leaves.length;s++){const o=this.leaves[s],r=o.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedStart,d=o.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedEnd,h=o.unitOfCodeWork.lineChanges?.lineChanges[0].originalStart,m=o.unitOfCodeWork.lineChanges?.lineChanges[0].originalEnd;if(r!==void 0&&d!==void 0&&h!==void 0&&m!==void 0){if(r!==d||i!==r){if(r<=i&&i<d){this.setCurrFocusedChunkIdx(s,!1);break}}else if(e.target.type===this._monaco.editor.MouseTargetType.CONTENT_VIEW_ZONE){const u=this._editor.getOriginalEditor(),c=u.getOption(this._monaco.editor.EditorOption.lineHeight),_=u.getScrolledVisiblePosition({lineNumber:h,column:0}),p=u.getScrolledVisiblePosition({lineNumber:m+1,column:0});if(_===null||p===null)continue;const I=_.top-c/2+t,A=p.top-c/2+t;if(e.event.posy>=I&&e.event.posy<=A){this.setCurrFocusedChunkIdx(s,!1);break}break}}}};get editorOffset(){return this._editorContainer.getBoundingClientRect().top}get currFocusedChunkIdx(){return this._focusModel.focusedItemIdx}get selectionLines(){return this._selectionLines}get mode(){return this._mode}get keybindings(){return this._keybindings}getOriginalEditor(){return this._editor.getOriginalEditor()}getModifiedEditor(){return this._editor.getModifiedEditor()}get isLoading(){return{subscribe:this._isLoadingDiffChunks.subscribe}}setLoading(e){this._isLoadingDiffChunks.set(e)}updateIsWebviewFocused=async e=>{await this._asyncMsgSender.send({type:D.diffViewWindowFocusChange,data:e})};setCurrFocusedChunkIdx=(e,t=!0)=>{this._focusModel.focusedItemIdx!==e&&(this._focusModel.setFocusIdx(e),t&&this.revealCurrFocusedChunk(),this.notifySubscribers())};revealCurrFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.revealChunk(e)};revealChunk=e=>{const t=e.unitOfCodeWork.lineChanges?.lineChanges[0],i=t?.modifiedStart;i!==void 0&&this._editor.revealLineNearTop(i-1)};renderCentralOverlayWidget=e=>{const t=()=>({editor:this._editor,id:"central-overlay-widget"}),i=pt(e,t(),{monaco:this._monaco});return{update:()=>{i.update(t())},destroy:i.destroy}};renderInstructionsDrawerViewZone=(e,t)=>{let i=!1,s=t;const o=t.autoFocus??!0,r=u=>{o&&!i&&(this._editor.revealLineNearTop(u),i=!0)},d=u=>({...u,ordinal:Ne.instructionDrawer,editor:this._editor,afterLineNumber:u.line}),h=Pe(e,d(t)),m=[];return o&&m.push(this._editor.onDidUpdateDiff((()=>{r(s.line)}))),{update:u=>{const c={...s,...u};_t(c,s)||(h.update(d(c)),s=c,r(c.line))},destroy:()=>{h.destroy(),m.forEach((u=>u.dispose()))}}};renderActionsViewZone=(e,t)=>{const i=o=>{let r;return r=o.chunk?o.chunk.unitOfCodeWork.lineChanges?.lineChanges[0].modifiedStart:1,{...o,ordinal:Ne.chunkActionPanel,editor:this._editor,afterLineNumber:r?r-1:void 0}},s=Pe(e,i(t));return{update:o=>{s.update(i(o))},destroy:s.destroy}};acceptAllChunks=()=>{this.leaves&&this.acceptChunks(this.leaves,!0)};rejectAllChunks=()=>{this.leaves&&this.rejectChunks(this.leaves,!0)};acceptFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.acceptChunk(e)};rejectFocusedChunk=()=>{const e=this._focusModel.focusedItem;e&&this.rejectChunk(e)};focusNextChunk=()=>{this._focusModel.focusNext(),this.revealCurrFocusedChunk()};focusPrevChunk=()=>{this._focusModel.focusPrev(),this.revealCurrFocusedChunk()};initialize=async()=>{const e=await this._asyncMsgSender.send({type:D.diffViewLoaded},2e3);this._resetScrollOnInit();const{file:t,instruction:i,keybindings:s,editable:o}=e.data;this._editor.updateOptions({readOnly:!o});const r=H(this._keybindings);this._keybindings.set(s??r);const d=i?.selection;d&&(d.start.line===d.end.line&&d.start.character===d.end.character&&this._mode.set(ue.instruction),H(this.selectionLines)===void 0&&this._selectionLines.set({start:d.start.line,end:d.end.line})),this.updateModels(t.originalCode??"",t.modifiedCode??"",{rootPath:t.repoRoot,relPath:t.pathName}),this._currStream?.finish(),this._currStream=void 0,this._disableResolution.set(!!e.data.disableResolution),this._disableApply.set(!!e.data.disableApply),await this._tryFetchStream(),this._syncStreamToModels()};disposeDiffViewPanel=async()=>{await this._asyncMsgSender.send({type:D.disposeDiffView})};_tryFetchStream=async()=>{const e=this._asyncMsgSender.stream({type:D.diffViewFetchPendingStream},15e3,6e4);for await(const t of e)switch(t.type){case D.diffViewDiffStreamStarted:{this.setLoading(!0),this._requestId.set(t.data.requestId);const i=this._editor.getOriginalEditor().getValue();this._currStream=new St(t.data.streamId,i,this._monaco),this._syncStreamToModels();break}case D.diffViewDiffStreamEnded:if(this._currStream?.id!==t.data.streamId)return;this.setLoading(!1),this._cleanupStream();break;case D.diffViewDiffStreamChunk:{if(this._currStream?.id!==t.data.streamId)return;const i=this._editor.getOriginalEditor().getModel();if(!this._editor.getModifiedEditor().getModel()||!i)return this.setLoading(!1),void this._cleanupStream();const s=this._currStream?.onReceiveChunk(t);s&&(this._applyDeltaDiff(s),H(this._selectionLines)!=null&&this._selectionLines.set(null));break}}};handleMessageFromExtension=async e=>{switch(e.data.type){case D.diffViewNotifyReinit:this.setLoading(!1),this._cleanupStream(),this.initialize();break;case D.diffViewAcceptAllChunks:this.acceptAllChunks();break;case D.diffViewAcceptFocusedChunk:this.acceptFocusedChunk();break;case D.diffViewRejectFocusedChunk:this.rejectFocusedChunk();break;case D.diffViewFocusPrevChunk:this.focusPrevChunk();break;case D.diffViewFocusNextChunk:this.focusNextChunk()}};_applyDeltaDiff=e=>{const t=this._editor.getOriginalEditor().getModel(),i=this._editor.getModifiedEditor().getModel();t&&i&&(t.pushEditOperations([],e.resetOriginal,(()=>[])),e.original.forEach((s=>{t.pushEditOperations([],[s],(()=>[]))})),e.modified.forEach((s=>{i.pushEditOperations([],[s],(()=>[]))})))};_cleanupStream=()=>{if(this._currStream){const e=this._currStream?.finish();this._applyDeltaDiff(e),this._currStream=void 0,this._resetScrollOnInit()}};_syncStreamToModels=()=>{const e=this._currStream?.originalValue,t=this._currStream?.modifiedValue;e&&e!==this._editor.getOriginalEditor().getValue()&&this._editor.getOriginalEditor().setValue(e),t&&t!==this._editor.getModifiedEditor().getValue()&&this._editor.getModifiedEditor().setValue(t)};acceptChunk=async e=>{H(this._disableApply)||this.acceptChunks([e])};acceptChunks=async(e,t=!1)=>{H(this._disableApply)||(this.executeDiffChunks(e,!0),this.notifyResolvedChunks(e,Ie.accept,t),await Ee(),this.areModelsEqual()&&!H(this.isLoading)&&this.disposeDiffViewPanel())};areModelsEqual=()=>{const e=this._editor.getModel()?.original,t=this._editor.getModel()?.modified;return e?.getValue()===t?.getValue()};rejectChunk=async e=>{this.rejectChunks([e])};rejectChunks=async(e,t=!1)=>{this.executeDiffChunks(e,!1),this.notifyResolvedChunks(e,Ie.reject,t),await Ee(),this.areModelsEqual()&&!H(this.isLoading)&&this.disposeDiffViewPanel()};get _originalCode(){return this._currStream?.originalCode??this._editor.getOriginalEditor().getValue()}get _modifiedCode(){return this._editor.getModifiedEditor().getValue()}notifyDiffViewUpdated=Re((()=>{this.notifyResolvedChunks([],Ie.accept)}),1e3);notifyResolvedChunks=async(e,t,i=!1)=>{const s=this._editor.getModel()?.original.uri.path;s&&await this._asyncMsgSender.send({type:D.diffViewResolveChunk,data:{file:{repoRoot:"",pathName:s,originalCode:this._originalCode,modifiedCode:this._modifiedCode},changes:e.map((o=>o.unitOfCodeWork)),resolveType:t,shouldApplyToAll:i}},2e3)};executeDiffChunks=(e,t)=>{if(H(this._disableResolution)||t&&H(this._disableApply))return;const i=this._editor.getModel()?.original,s=this._editor.getModel()?.modified;if(!i||!s||this._currStream!==void 0)return;const o=[],r=[];for(const u of e){const c=u.unitOfCodeWork.lineChanges?.lineChanges[0];if(!c||u.unitOfCodeWork.originalCode===void 0||u.unitOfCodeWork.modifiedCode===void 0)continue;let _={startLineNumber:c.originalStart,startColumn:1,endLineNumber:c.originalEnd,endColumn:1},p={startLineNumber:c.modifiedStart,startColumn:1,endLineNumber:c.modifiedEnd,endColumn:1};const I=t?u.unitOfCodeWork.modifiedCode:u.unitOfCodeWork.originalCode;I!==void 0&&(o.push({range:_,text:I}),r.push({range:p,text:I}))}i.pushEditOperations([],o,(()=>[])),s.pushEditOperations([],r,(()=>[]));const d=this._focusModel.nextIdx({nowrap:!0});if(d===void 0)return;const h=d===this._focusModel.focusedItemIdx?d-1:d,m=this._focusModel.items[h];m&&this.revealChunk(m)};get leaves(){const e=this.codeChunk;if(e)return Ge(e)}get codeChunk(){return this._rootChunk}updateCodeChunk=()=>{this._rootChunk=this.computeCodeChunk(),this._focusModel.setItems(this.leaves??[]),this._focusModel.initFocusIdx(0),this.notifySubscribers()};computeCodeChunk(){const e=[],t=this._editor.getLineChanges(),i=this._editor.getModel()?.original,s=this._editor.getModel()?.modified;if(t&&i&&s){for(const o of t){const r=je({startLineNumber:o.originalStartLineNumber,endLineNumber:o.originalEndLineNumber}),d=je({startLineNumber:o.modifiedStartLineNumber,endLineNumber:o.modifiedEndLineNumber}),h=Nt(this._editor,r,d);e.push(h)}return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],children:e,childIds:e.map((o=>o.id))}}}handleInstructionSubmit=e=>{const t=this._editor.getModifiedEditor(),i=this.getSelectedCodeDetails(t);if(!i)throw Error("No selected code details found");const s=dt.select(this._reduxStore.getState());this._reduxStore.dispatch(at(s,e,i))};updateModels=(e,t,i)=>{const s=this._editor.getModel()?.original?.uri,o=(i&&this._monaco.Uri.file(i.relPath))??s;if(o)if(s?.fsPath!==o.fsPath||s?.authority!==o.authority){const r=o.with({fragment:crypto.randomUUID()}),d=o.with({fragment:crypto.randomUUID()});this._editor.setModel({original:this._monaco.editor.createModel(e,void 0,r),modified:this._monaco.editor.createModel(t??"",void 0,d)})}else this._originalCode!==e&&this.getOriginalEditor().setValue(e),this._modifiedCode!==t&&this.getModifiedEditor().setValue(t??"");else console.warn("No URI found for diff view. Not updating models.")};updateTheme=e=>{this._monaco.editor.setTheme(e)};getSelectedCodeDetails(e){const t=e.getModel();if(!t)return null;const i=t.getLanguageId(),s=1,o=1,r={lineNumber:t.getLineCount(),column:t.getLineMaxColumn(t.getLineCount())},d=H(this._selectionLines);if(!d)throw new Error("No selection lines found");const h=Math.min(d.end+1,r.lineNumber),m=new this._monaco.Range(d.start+1,1,h,t.getLineMaxColumn(h));let u=t.getValueInRange(m);h<t.getLineCount()&&(u+=t.getEOL());const c=new this._monaco.Range(s,o,m.startLineNumber,m.startColumn),_=Math.min(m.endLineNumber+1,r.lineNumber),p=new this._monaco.Range(_,1,r.lineNumber,r.column);return{selectedCode:u,prefix:t.getValueInRange(c),suffix:t.getValueInRange(p),path:t.uri.path,language:i,prefixBegin:c.startLineNumber-1,suffixEnd:p.endLineNumber-1}}}function Nt(a,e,t){const i=a.getModel()?.original,s=a.getModel()?.modified;if(!i||!s)throw new Error("No models found");return(function(o,r,d,h){return{id:crypto.randomUUID(),name:"",title:"",description:"",generationSource:"",supportedActions:[],unitOfCodeWork:{repoRoot:"",pathName:"",originalCode:o,modifiedCode:r,lineChanges:{lineChanges:[{originalStart:d.startLineNumber,originalEnd:d.endLineNumber,modifiedStart:h.startLineNumber,modifiedEnd:h.endLineNumber}],lineOffset:0}},children:[],childIds:[]}})(i.getValueInRange(e),s.getValueInRange(t),e,t)}function je(a){return a.endLineNumber===0?{startLineNumber:a.startLineNumber+1,startColumn:1,endLineNumber:a.startLineNumber+1,endColumn:1}:{startLineNumber:a.startLineNumber,startColumn:1,endLineNumber:a.endLineNumber+1,endColumn:1}}var Vt=C('<span class="c-keyboard-shortcut-hint__icon svelte-1s22lg"> </span>'),Ot=C("<span></span>");function se(a,e){ce(e,!0);let t=oe(e,"keybinding",19,(()=>{})),i=oe(e,"icons",19,(()=>t()?.split("-")??[]));var s=Ot();qe(s,21,i,ze,((o,r)=>{var d=Vt(),h=O(d);le((()=>Ve(h,n(r)))),f(o,d)})),le((()=>Ce(s,1,et(["c-keyboard-shortcut-hint",e.class]),"svelte-1s22lg"))),f(a,s),he()}var Ft=C("<!> Accept",1),Dt=C("<!> Reject",1),Rt=C("<div></div>  <div><div><!> <!></div></div>",1);function $t(a,e){ce(e,!0);const t=()=>S(h,"$keybindingsStore",i),[i,s]=be();let o=oe(e,"align",3,"right"),r=oe(e,"heightInPx",3,1),d=oe(e,"disableApply",3,!1);const h=e.diffViewModel.keybindings;let m=R(0);const u=k=>{w(m,k,!0)};let c,_=R(!1);function p(){c&&(clearTimeout(c),c=void 0),w(_,!1)}function I(k){k.target.closest(".c-button-container")?p():k.type==="mouseenter"||k.type==="mousemove"?(p(),c=setTimeout((()=>{w(_,!0)}),400)):k.type==="mouseleave"&&p()}var A=Rt(),j=x(A);let q;Ze(j,((k,F)=>e.diffViewModel.renderActionsViewZone?.(k,F)),(()=>({chunk:e.leaf,heightInPx:r(),onDomNodeTop:u})));var P=y(j,2);let z;P.__mousemove=I;var T=O(P);let Q;var l=O(T),L=k=>{Y(k,{size:1,variant:"ghost",color:"success",get onclick(){return e.onAccept},children:(F,B)=>{var G=Ft();se(x(G),{get keybinding(){return t().acceptFocusedChunk}}),f(F,G)},$$slots:{default:!0}})};Z(l,(k=>{d()||k(L)}));var U=y(l,2);Y(U,{size:1,variant:"ghost",color:"error",get onclick(){return e.onReject},children:(k,F)=>{var B=Dt();se(x(B),{get keybinding(){return t().rejectFocusedChunk}}),f(k,B)},$$slots:{default:!0}}),le((()=>{q=Ce(j,1,"svelte-1kwtokq",null,q,{"c-chunk-diff-border--focused":!!e.leaf&&e.isFocused}),z=Ce(P,1,"c-chunk-action-panel-anchor svelte-1kwtokq",null,z,{"c-chunk-action-panel-anchor--left":o()==="left","c-chunk-action-panel-anchor--right":o()==="right","c-chunk-action-panel-anchor--focused":e.isFocused}),Be(P,`top: ${n(m)??""}px;`),Q=Ce(T,1,"c-button-container svelte-1kwtokq",null,Q,{"c-button-container--focused":e.isFocused,"c-button-container--transparent":n(_)})})),me("mouseenter",P,I),me("mouseleave",P,I),f(a,A),he(),s()}Ue(["mousemove"]);var At=C('<span class="c-diff-page-counter svelte-17ip48s">Generating changes <!></span>'),Pt=C('<span class="c-diff-page-counter svelte-17ip48s"> <!></span>'),Tt=C('<span class="c-diff-page-counter svelte-17ip48s">No changes</span>'),Wt=C("<!> Back",1),jt=C("<!> Next",1),qt=C("<!> Accept All",1),zt=C("<!> Reject All",1),Ut=C("<!> <!>",1),Bt=C("<!> <!> <!>",1),Ht=C('<div class="c-top-action-panel-anchor svelte-17ip48s"><div class="c-button-container svelte-17ip48s"><!> <!> <!></div></div>');function Zt(a,e){ce(e,!0);const t=()=>S(e.diffViewModel,"$diffViewModel",r),i=()=>S(m,"$requestId",r),s=()=>S(n(I),"$isLoadingStore",r),o=()=>S(h,"$keybindingsStore",r),[r,d]=be(),h=e.diffViewModel.keybindings,m=e.diffViewModel.requestId;let u,c=$((()=>t().disableResolution)),_=$((()=>t().disableApply)),p=$((()=>t().currFocusedChunkIdx!==void 0?(t().currFocusedChunkIdx+1).toString():"x")),I=$((()=>t().isLoading)),A=$((()=>!!t().leaves?.length)),j=R("Copy request ID"),q=R(void 0);function P(b){b||(clearTimeout(u),u=void 0,w(j,"Copy request ID"))}async function z(){i()&&(await navigator.clipboard.writeText(i()),w(j,"Copied!"),clearTimeout(u),u=setTimeout((()=>n(q)?.requestClose()),1500))}var T=Ht(),Q=O(T),l=O(Q),L=b=>{{let N=$((()=>[kt.Hover]));_e(Ct(b,{onOpenChange:P,get content(){return n(j)},get triggerOn(){return n(N)},children:(E,J)=>{vt(E,{variant:"ghost",color:"neutral",size:1,onclick:z,children:(X,g)=>{Ke(X,{name:"copy"})},$$slots:{default:!0}})},$$slots:{default:!0}}),(E=>w(q,E,!0)),(()=>n(q)))}};Z(l,(b=>{i()&&b(L)}));var U=y(l,2),k=b=>{var N=At(),E=y(O(N));Te(E,{size:1,get loading(){return s()}}),f(b,N)},F=b=>{var N=xe(),E=x(N),J=g=>{var v=Pt(),V=O(v),M=y(V);Te(M,{size:1,get loading(){return s()}}),le((()=>Ve(V,`${n(p)??""} of ${t()?.leaves?.length??""} `))),f(g,v)},X=g=>{var v=Tt();f(g,v)};Z(E,(g=>{n(A)?g(J):g(X,!1)}),!0),f(b,N)};Z(U,(b=>{!n(A)&&s()?b(k):b(F,!1)}));var B=y(U,2),G=b=>{var N=Bt(),E=x(N);Y(E,{size:1,variant:"ghost",color:"neutral",get onclick(){return e.diffViewModel.focusPrevChunk},children:(v,V)=>{var M=Wt();se(x(M),{get keybinding(){return o().focusPrevChunk}}),f(v,M)},$$slots:{default:!0}});var J=y(E,2);Y(J,{size:1,variant:"ghost",color:"neutral",get onclick(){return e.diffViewModel.focusNextChunk},children:(v,V)=>{var M=jt();se(x(M),{get keybinding(){return o().focusNextChunk}}),f(v,M)},$$slots:{default:!0}});var X=y(J,2),g=v=>{var V=Ut(),M=x(V),ee=te=>{Y(te,{size:1,variant:"ghost",color:"success",get onclick(){return e.diffViewModel.acceptAllChunks},children:(pe,ne)=>{var ve=qt();se(x(ve),{get keybinding(){return o().acceptAllChunks}}),f(pe,ve)},$$slots:{default:!0}})};Z(M,(te=>{S(n(_),"$disableApply",r)||te(ee)}));var fe=y(M,2);Y(fe,{size:1,variant:"ghost",color:"error",get onclick(){return e.diffViewModel.rejectAllChunks},children:(te,pe)=>{var ne=zt();se(x(ne),{get keybinding(){return o().rejectAllChunks}}),f(te,ne)},$$slots:{default:!0}}),f(v,V)};Z(X,(v=>{S(n(c),"$disableResolution",r)||v(g)})),f(b,N)};Z(B,(b=>{n(A)&&b(G)})),f(a,T),he(),d()}var Kt=C("<!> <!> <!> <!>",1),Gt=C("Close <!>",1),Jt=C('<div class="instruction-overlay-wrapper"><div></div> <div class="instruction-drawer-panel svelte-7w2pxx"><div class="instruction-drawer-panel__contents svelte-7w2pxx" tabindex="0" role="button"><div class="l-input-area__input svelte-7w2pxx"><!></div> <div class="c-instruction-drawer-panel__btn-container svelte-7w2pxx"><!> <!></div></div></div></div>'),Qt=C("<!> <!>",1);function Yt(a,e){ce(e,!0);const t=()=>S(I,"$modeStore",o),i=()=>S(A,"$selectionLinesStore",o),s=()=>S(U,"$currentConversationId",o),[o,r]=be();let d=oe(e,"initialFlags",19,(()=>{}));const h=It.getContext().monaco,m={isWholeLine:!0,marginClassName:"instruction-edit-area-margin"};let u,c,_=R(void 0),p=R("");const I=e.diffViewModel.mode,A=e.diffViewModel.selectionLines;let j=$((()=>(t()===ue.instruction?"Instruct":"Edit with")+" Augment... @ to focus on files or docs"));function q(){const g=e.diffViewModel.getModifiedEditor(),v=H(h);if(!g||!v||(c?.clear(),!i()))return;const V=i().start,M=i().end,ee={range:new v.Range(V+1,1,M+1,1),options:m};c||(c=g.createDecorationsCollection()),c.set([ee])}function P(){return!!n(p)?.trim()&&(e.diffViewModel.handleInstructionSubmit(n(p)),!0)}Se((async()=>{await Ee(),B(),w(z,e.diffViewModel.editorOffset,!0)})),He((()=>{u?.destroy(),c?.clear()}));let z=R(0),T=R(57),Q=$((()=>S(e.diffViewModel,"$diffViewModel",o).isLoading));ke((()=>{if(n(_)){if(i()==null)w(T,0);else{const g=n(_).scrollHeight;w(T,Math.min(40+g,108),!0)}u?.update({heightInPx:n(T)}),q()}}));let l=R(void 0),L=R(void 0);const U=ct(),k=Le(),F=()=>n(l)?.requestFocus(),B=()=>n(l)?.forceFocus(),G=g=>{s()&&k(lt(s(),g.current))};function b(g){w(p,g.rawText,!0)}var N=Qt(),E=x(N);(function(g,v){ce(v,!0);const V=oe(v,"featureFlags",19,(()=>({}))),M=Le();Se((()=>{V()&&M(ut({areFlagsReady:!0,...V()}))})),he()})(0,{get featureFlags(){return d()}});var J=y(E,2),X=g=>{var v=Jt(),V=O(v);Ze(V,(W=>(function(re){const K=i()?i().start:1;return u=e.diffViewModel.renderInstructionsDrawerViewZone(re,{line:K,heightInPx:n(T),onDomNodeTop:de=>{w(z,e.diffViewModel.editorOffset+de)},autoFocus:!0}),q(),{destroy(){u&&(u.destroy(),u=void 0),c&&(c.clear(),c=void 0)}}})(W)));var M=y(V,2),ee=O(M);ee.__click=B,ee.__keydown=W=>{W.key==="Enter"&&(B(),W.stopPropagation(),W.preventDefault())};var fe=O(ee),te=O(fe);Ae(te,(()=>We.Root),((W,re)=>{_e(re(W,{focusOnInit:!0,children:(K,de)=>{var ye=Kt(),ge=x(ye);bt(ge,{shortcuts:{Enter:()=>P()}});var Oe=y(ge,2);_e(yt(Oe,{requestEditorFocus:F,onMentionItemsUpdated:G}),(we=>w(L,we,!0)),(()=>n(L)));var Fe=y(Oe,2);Ae(Fe,(()=>We.Content),((we,Qe)=>{Qe(we,{get content(){return n(p)},onContentChanged:b})}));var Je=y(Fe,2);wt(Je,{get placeholder(){return n(j)}}),f(K,ye)},$$slots:{default:!0}}),(K=>w(l,K,!0)),(()=>n(l)))})),_e(fe,(W=>w(_,W)),(()=>n(_)));var pe=y(fe,2),ne=O(pe);Y(ne,{id:"close",size:1,variant:"soft",color:"neutral",title:"Close",get onclick(){return e.diffViewModel.disposeDiffViewPanel},children:(W,re)=>{var K=Gt();se(y(x(K)),{keybinding:"esc"}),f(W,K)},$$slots:{default:!0}});var ve=y(ne,2);{const W=de=>{Ke(de,{name:"send-horizontal"})};let re=$((()=>t()===ue.instruction?"Instruct Augment":"Edit with Augment")),K=$((()=>!n(p).trim()||S(n(Q),"$isLoadingStore",o)));Y(ve,{id:"send",size:1,variant:"solid",color:"accent",get title(){return n(re)},get disabled(){return n(K)},onclick:P,iconRight:W,children:(de,ye)=>{var ge=tt();le((()=>Ve(ge,t()===ue.instruction?"Instruct":"Edit"))),f(de,ge)},$$slots:{iconRight:!0,default:!0}})}le((()=>Be(M,`top: ${n(z)??""}px; height: ${n(T)??""}px;`))),f(g,v)};Z(J,(g=>{i()&&g(X)})),f(a,N),he(),r()}Ue(["click","keydown"]);var Xt=C('<div class="sticky-top svelte-1nhwlxa"><!></div> <!>',1),ei=C('<div class="diff-view-container svelte-1nhwlxa"><!> <div class="editor-container svelte-1nhwlxa"><div class="editor svelte-1nhwlxa"></div> <!></div></div>');function ti(a,e){ce(e,!0);const t=()=>S(st,"$themeStore",s),i=()=>S(n(r),"$diffViewModel",s),[s,o]=be();let r=R(void 0),d=R(void 0),h=$((()=>n(r)?.disableApply)),m=$((()=>n(r)?.disableResolution));const u=Le();function c(l){const L=ot.dark;return Mt(l?.category||L,l?.intensity)??Et.get(L)}ke((()=>{const l=t();n(r)&&n(r)?.updateTheme(c(l))}));let _=R(void 0);ke((()=>{n(_)&&n(d)&&!n(r)&&it(w(r,new Lt(n(d),ht().store,c(t()),n(_)),!0),"$diffViewModel",s)})),Se((async()=>{w(_,await window.augmentDeps.monaco,!0),n(_)?u(ft(void 0,{})):console.error("Monaco not loaded. Diff view cannot be initialized.")})),He((()=>{n(r)?.dispose()}));let p=$((()=>i()?.leaves)),I=R(!1);ke((()=>{n(r)?.updateIsWebviewFocused(n(I))}));var A=ei();me("message",Me,(function(...l){n(r)?.handleMessageFromExtension?.apply(this,l)})),me("focus",Me,(()=>w(I,!0))),me("blur",Me,(()=>w(I,!1)));var j=O(A),q=l=>{var L=Xt(),U=x(L);Zt(O(U),{get diffViewModel(){return i()}}),Yt(y(U,2),{get diffViewModel(){return i()}}),f(l,L)};Z(j,(l=>{i()&&l(q)}));var P=y(j,2),z=O(P);_e(z,(l=>w(d,l)),(()=>n(d)));var T=y(z,2),Q=l=>{var L=xe(),U=x(L);qe(U,17,(()=>n(p)),ze,((k,F,B)=>{var G=xe(),b=x(G),N=E=>{{let J=$((()=>i()?.currFocusedChunkIdx===B));$t(E,{get isFocused(){return n(J)},onAccept:()=>i()?.acceptChunk(n(F)),onReject:()=>i()?.rejectChunk(n(F)),get diffViewModel(){return i()},get leaf(){return n(F)},align:"right",get disableApply(){return S(n(h),"$disableApply",s)}})}};Z(b,(E=>{n(F).unitOfCodeWork.modifiedCode!==n(F).unitOfCodeWork.originalCode&&E(N)})),f(k,G)})),f(l,L)};Z(T,(l=>{i()&&n(p)?.length&&!S(n(m),"$disableResolution",s)&&l(Q)})),f(a,A),he(),o()}nt((function(a){rt.Root(a,{children:(e,t)=>{gt(e,{children:(i,s)=>{mt(i,{children:(o,r)=>{ti(o,{})},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}})}),{target:document.getElementById("app")});
//# sourceMappingURL=diff-view-BA5bH_HK.js.map
